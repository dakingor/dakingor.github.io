<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dagger2 | 大坚博客</title>
    <meta name="description" content="现在还远远没有达到需要拼智商的地步">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/styles.bb1fe17d.css" as="style"><link rel="preload" href="/assets/js/app.bb1fe17d.js" as="script"><link rel="preload" href="/assets/js/15.e903c1ca.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.b05fc641.css"><link rel="prefetch" href="/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/assets/js/1.b05fc641.js"><link rel="prefetch" href="/assets/js/10.326ff491.js"><link rel="prefetch" href="/assets/js/11.9241fc7b.js"><link rel="prefetch" href="/assets/js/12.7acf36a5.js"><link rel="prefetch" href="/assets/js/13.ec549dd5.js"><link rel="prefetch" href="/assets/js/14.28942eba.js"><link rel="prefetch" href="/assets/js/16.4d7ab5b5.js"><link rel="prefetch" href="/assets/js/17.36afdc36.js"><link rel="prefetch" href="/assets/js/18.cac2535e.js"><link rel="prefetch" href="/assets/js/19.cd2f75e9.js"><link rel="prefetch" href="/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/assets/js/20.bf313935.js"><link rel="prefetch" href="/assets/js/21.31b36d89.js"><link rel="prefetch" href="/assets/js/22.0361f270.js"><link rel="prefetch" href="/assets/js/23.1b3f1574.js"><link rel="prefetch" href="/assets/js/24.4d491f2a.js"><link rel="prefetch" href="/assets/js/25.52f1876f.js"><link rel="prefetch" href="/assets/js/26.e08e41e4.js"><link rel="prefetch" href="/assets/js/27.4bbac78e.js"><link rel="prefetch" href="/assets/js/28.b5bd620c.js"><link rel="prefetch" href="/assets/js/29.84b65be3.js"><link rel="prefetch" href="/assets/js/3.c091e437.js"><link rel="prefetch" href="/assets/js/30.fe84dfad.js"><link rel="prefetch" href="/assets/js/31.166d5bc3.js"><link rel="prefetch" href="/assets/js/32.d65d9239.js"><link rel="prefetch" href="/assets/js/33.583bc596.js"><link rel="prefetch" href="/assets/js/34.6b83f133.js"><link rel="prefetch" href="/assets/js/35.49d1569f.js"><link rel="prefetch" href="/assets/js/36.0446fb7e.js"><link rel="prefetch" href="/assets/js/37.5fbd12a4.js"><link rel="prefetch" href="/assets/js/38.1b808891.js"><link rel="prefetch" href="/assets/js/39.3b1c557a.js"><link rel="prefetch" href="/assets/js/4.fb6903e4.js"><link rel="prefetch" href="/assets/js/40.ac5b164f.js"><link rel="prefetch" href="/assets/js/41.45b078e5.js"><link rel="prefetch" href="/assets/js/42.d40844bf.js"><link rel="prefetch" href="/assets/js/43.9009d6e3.js"><link rel="prefetch" href="/assets/js/44.1e61fc92.js"><link rel="prefetch" href="/assets/js/45.9424e6d8.js"><link rel="prefetch" href="/assets/js/46.efbee1cd.js"><link rel="prefetch" href="/assets/js/47.cee8ae47.js"><link rel="prefetch" href="/assets/js/48.3d5e7cb5.js"><link rel="prefetch" href="/assets/js/49.22238313.js"><link rel="prefetch" href="/assets/js/5.8891e232.js"><link rel="prefetch" href="/assets/js/50.4affbe35.js"><link rel="prefetch" href="/assets/js/51.fdb6ae2c.js"><link rel="prefetch" href="/assets/js/52.30127554.js"><link rel="prefetch" href="/assets/js/53.0dacde79.js"><link rel="prefetch" href="/assets/js/54.e2815542.js"><link rel="prefetch" href="/assets/js/55.83d95da2.js"><link rel="prefetch" href="/assets/js/56.fd6cfa75.js"><link rel="prefetch" href="/assets/js/57.64041257.js"><link rel="prefetch" href="/assets/js/58.feb49a9c.js"><link rel="prefetch" href="/assets/js/59.dc8df387.js"><link rel="prefetch" href="/assets/js/6.d54c1117.js"><link rel="prefetch" href="/assets/js/60.631c04b3.js"><link rel="prefetch" href="/assets/js/61.32aea37e.js"><link rel="prefetch" href="/assets/js/62.5cfec479.js"><link rel="prefetch" href="/assets/js/63.1433dd8f.js"><link rel="prefetch" href="/assets/js/64.ad33ff3d.js"><link rel="prefetch" href="/assets/js/65.701a8222.js"><link rel="prefetch" href="/assets/js/66.24bd90de.js"><link rel="prefetch" href="/assets/js/67.d396f2ec.js"><link rel="prefetch" href="/assets/js/68.2afd7019.js"><link rel="prefetch" href="/assets/js/69.05781e5f.js"><link rel="prefetch" href="/assets/js/7.1b94b949.js"><link rel="prefetch" href="/assets/js/70.2cf85943.js"><link rel="prefetch" href="/assets/js/71.aab07104.js"><link rel="prefetch" href="/assets/js/72.1533ead8.js"><link rel="prefetch" href="/assets/js/73.4e5dc4da.js"><link rel="prefetch" href="/assets/js/74.e77dfcb1.js"><link rel="prefetch" href="/assets/js/75.e8e4c83e.js"><link rel="prefetch" href="/assets/js/76.ce341a40.js"><link rel="prefetch" href="/assets/js/77.c2342e89.js"><link rel="prefetch" href="/assets/js/78.a56458f9.js"><link rel="prefetch" href="/assets/js/79.6407212c.js"><link rel="prefetch" href="/assets/js/8.f8c818df.js"><link rel="prefetch" href="/assets/js/80.6554cb4c.js"><link rel="prefetch" href="/assets/js/81.84c710c0.js"><link rel="prefetch" href="/assets/js/82.32cdc5bb.js"><link rel="prefetch" href="/assets/js/83.e08a0de0.js"><link rel="prefetch" href="/assets/js/84.59fefb9d.js"><link rel="prefetch" href="/assets/js/85.af63859c.js"><link rel="prefetch" href="/assets/js/86.513e36a1.js"><link rel="prefetch" href="/assets/js/87.c45c0b70.js"><link rel="prefetch" href="/assets/js/88.92b080af.js"><link rel="prefetch" href="/assets/js/89.ad5aec24.js"><link rel="prefetch" href="/assets/js/9.6d13d821.js"><link rel="prefetch" href="/assets/js/90.a5156631.js"><link rel="prefetch" href="/assets/js/91.fac5ac80.js"><link rel="prefetch" href="/assets/js/92.07aa1e42.js"><link rel="prefetch" href="/assets/js/93.c5f9a0d5.js"><link rel="prefetch" href="/assets/js/94.e05d5d7e.js"><link rel="prefetch" href="/assets/js/95.fea62791.js"><link rel="prefetch" href="/assets/js/96.449a8e88.js"><link rel="prefetch" href="/assets/js/97.94f2a5fd.js">
    <link rel="stylesheet" href="/assets/css/1.styles.b05fc641.css"><link rel="stylesheet" href="/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/assets/css/styles.bb1fe17d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">大坚博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">客户端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/android/Activity生命周期.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/html/CSS的创建与表现.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kotlin/Kotlin语法基础.html" class="nav-link">Kotlin</a></li><li class="dropdown-item"><!----> <a href="/java/Java平台.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/c/类型、运算符与表达式.html" class="nav-link">C</a></li><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/设计模式基础.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/data-structure/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/network-and-security/" class="nav-link">网络与安全</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系统与工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/mac/Homebrew.html" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/gradle/" class="nav-link">Gradle</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">多媒体</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opencv/搭建OpenCV Android项目.html" class="nav-link">OpenCV</a></li><li class="dropdown-item"><!----> <a href="/ffmpeg/macOS上编译FFmpeg.html" class="nav-link">FFmpeg</a></li></ul></div></div><div class="nav-item"><a href="/about-me/" class="nav-link">关于我</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">客户端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/android/Activity生命周期.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/html/CSS的创建与表现.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">MySQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kotlin/Kotlin语法基础.html" class="nav-link">Kotlin</a></li><li class="dropdown-item"><!----> <a href="/java/Java平台.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/c/类型、运算符与表达式.html" class="nav-link">C</a></li><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/设计模式基础.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/data-structure/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/network-and-security/" class="nav-link">网络与安全</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系统与工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/mac/Homebrew.html" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/gradle/" class="nav-link">Gradle</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">多媒体</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opencv/搭建OpenCV Android项目.html" class="nav-link">OpenCV</a></li><li class="dropdown-item"><!----> <a href="/ffmpeg/macOS上编译FFmpeg.html" class="nav-link">FFmpeg</a></li></ul></div></div><div class="nav-item"><a href="/about-me/" class="nav-link">关于我</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Android基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Android框架</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/android/Android第三方库集中营.html" class="sidebar-link">Android第三方库集中营</a></li><li><a href="/android/注解处理.html" class="sidebar-link">注解处理</a></li><li><a href="/android/Dagger2.html" class="active sidebar-link">Dagger2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/android/Dagger2.html#依赖注入" class="sidebar-link">依赖注入</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#dagger2基础" class="sidebar-link">Dagger2基础</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#dagger2依赖" class="sidebar-link">Dagger2依赖</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#区分提供方" class="sidebar-link">区分提供方</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#限定作用域" class="sidebar-link">限定作用域</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#component" class="sidebar-link">Component</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#lazy与provider" class="sidebar-link">Lazy与Provider</a></li><li class="sidebar-sub-header"><a href="/android/Dagger2.html#dagger2注意事项" class="sidebar-link">Dagger2注意事项</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Android系统</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Android架构</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Android安全</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Android工具</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="dagger2"><a href="#dagger2" aria-hidden="true" class="header-anchor">#</a> Dagger2</h1> <p></p><div class="table-of-contents"><ul><li><a href="#依赖注入">依赖注入</a><ul><li><a href="#构造注入">构造注入</a></li><li><a href="#接口注入">接口注入</a></li><li><a href="#注解注入">注解注入</a></li></ul></li><li><a href="#dagger2基础">Dagger2基础</a><ul><li><a href="#dagger简介">Dagger简介</a></li><li><a href="#android配置-java版">Android配置-Java版</a></li><li><a href="#android配置-kotlin版">Android配置-Kotlin版</a></li><li><a href="#注解大全">注解大全</a></li></ul></li><li><a href="#dagger2依赖">Dagger2依赖</a><ul><li><a href="#两种提供依赖方式">两种提供依赖方式</a></li><li><a href="#inject-提供依赖">@Inject提供依赖</a></li><li><a href="#module-provides-提供依赖">@Module&amp;@Provides提供依赖</a></li></ul></li><li><a href="#区分提供方">区分提供方</a><ul><li><a href="#named">@Named</a></li><li><a href="#qualifier">@Qualifier</a></li></ul></li><li><a href="#限定作用域">限定作用域</a><ul><li><a href="#singleton">@Singleton</a></li><li><a href="#scope">@Scope</a></li></ul></li><li><a href="#component">Component</a><ul><li><a href="#component之间的依赖">Component之间的依赖</a></li><li><a href="#subcomponent">Subcomponent</a></li></ul></li><li><a href="#lazy与provider">Lazy与Provider</a></li><li><a href="#dagger2注意事项">Dagger2注意事项</a><ul><li><a href="#component类">Component类</a></li><li><a href="#module类">Module类</a></li><li><a href="#scope注解">scope注解</a></li></ul></li></ul></div><p></p> <h2 id="依赖注入"><a href="#依赖注入" aria-hidden="true" class="header-anchor">#</a> 依赖注入</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="构造注入"><a href="#构造注入" aria-hidden="true" class="header-anchor">#</a> 构造注入</h3> <p>通过给构造函数传参，进而给依赖的成员变量赋值，最终实现注入。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span>Engine engine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="接口注入"><a href="#接口注入" aria-hidden="true" class="header-anchor">#</a> 接口注入</h3> <p>实现接口方法，以传参的方式实现注入。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Injection</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">Injection</span><span class="token generics function"><span class="token punctuation">&lt;</span>Engine<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>Engine engine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="注解注入"><a href="#注解注入" aria-hidden="true" class="header-anchor">#</a> 注解注入</h3> <p>使用Java注解<strong>在编译阶段生成代码</strong>或<strong>在运行阶段通过反射调用代码</strong>，从而实现注入。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Inject</span>
    Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="dagger2基础"><a href="#dagger2基础" aria-hidden="true" class="header-anchor">#</a> Dagger2基础</h2> <h3 id="dagger简介"><a href="#dagger简介" aria-hidden="true" class="header-anchor">#</a> Dagger简介</h3> <p>Dagger是一个应用于Android和Java的依赖注入框架。目前有Dagger和Dagger2两个版本。</p> <p>Dagger是由Square公司受到Guice的启发而开发的，是半静态半运行时的。虽然它的依赖注入是完全静态的，但其有向无环图是基于反射来生成的，严重影响了性能。</p> <p>Dagger2是Google团队fork了Dagger项目进行改造升级后的产品。它使Dagger从半静态变成完全静态，从Map式的API变成声明式API。它生成的代码更优雅高效，而且可在编译期间发现错误。</p> <h3 id="android配置-java版"><a href="#android配置-java版" aria-hidden="true" class="header-anchor">#</a> Android配置-Java版</h3> <p>在工程的<code>build.gradle</code>中添加：</p> <div class="language-gradle line-numbers-mode"><pre class="language-text"><code>buildscript {
    dependencies {
        classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在模块的<code>build.gradle</code>中添加：</p> <div class="language-gradle line-numbers-mode"><pre class="language-text"><code>apply plugin: 'com.neenbedankt.android-apt'

dependencies {
    // dagger公用API
    compile &quot;com.google.dagger:dagger:$dagger_version&quot;
    // dagger注解处理器
    apt &quot;com.google.dagger:dagger-compiler:$dagger_version&quot;
    // 添加android缺失的部分javax注解
    provided &quot;javax.annotation:jsr250-api:1.0&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="android配置-kotlin版"><a href="#android配置-kotlin版" aria-hidden="true" class="header-anchor">#</a> Android配置-Kotlin版</h3> <p>在模块的<code>build.gradle</code>中添加：</p> <div class="language-gradle line-numbers-mode"><pre class="language-text"><code>apply plugin: 'kotlin-kapt'

dependencies {
    // dagger公用API
    implementation &quot;com.google.dagger:dagger:$dagger_version&quot;
    // dagger注解处理器
    kapt &quot;com.google.dagger:dagger-compiler:$dagger_version&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="注解大全"><a href="#注解大全" aria-hidden="true" class="header-anchor">#</a> 注解大全</h3> <table><thead><tr><th style="text-align:left">注解</th> <th style="text-align:left">用法</th></tr></thead> <tbody><tr><td style="text-align:left"><code>@Inject</code></td> <td style="text-align:left">有两个作用：<br>1. 标记需要依赖的变量，以此告知Dagger要为它提供依赖。<br>2. 标记构造函数，为被<code>@Inject</code>标记的变量提供所需依赖。</td></tr> <tr><td style="text-align:left"><code>@Module</code></td> <td style="text-align:left">用于标注提供依赖的类。<br>该类中的方法专门提供依赖。</td></tr> <tr><td style="text-align:left"><code>@Provides</code></td> <td style="text-align:left">用于标注<code>@Module</code>类中的方法。<br>该方法在需要提供依赖时被调用，从而把预先提供好的对象赋值给<code>@Inject</code>变量。</td></tr> <tr><td style="text-align:left"><code>@Component</code></td> <td style="text-align:left">用于标注接口，是依赖需求方和依赖提供方之间的桥梁。<br><code>@Component</code>接口在编译时会生成对应的实现类，如CarComponent接口生成DaggerCarComponent类。用户可通过调用这个实现类的方法完成注入。</td></tr> <tr><td style="text-align:left"><code>@Qulifier</code></td> <td style="text-align:left">用于自定义注解。<br>通过自定义的注解去标注依赖提供方和需求方，能区分同一个接口的不同实现类，避免“注解迷失”。</td></tr> <tr><td style="text-align:left"><code>@Named</code></td> <td style="text-align:left">是<code>@Qulifier</code>的一种默认实现。</td></tr> <tr><td style="text-align:left"><code>@Scope</code></td> <td style="text-align:left">限定注解作用域，实现局部的单例。<br>Scope主要用于Component的组织方式。<br>管理Component和Module之间的匹配关系。</td></tr> <tr><td style="text-align:left"><code>@Singleton</code></td> <td style="text-align:left">是<code>@Scope</code>的一种默认实现，表示全局单例。<br>实际上Singleton并没有实现单例的能力，它是否能提供全局单例要取决于对应的Component是否为一个全局对象。</td></tr></tbody></table> <h2 id="dagger2依赖"><a href="#dagger2依赖" aria-hidden="true" class="header-anchor">#</a> Dagger2依赖</h2> <h3 id="两种提供依赖方式"><a href="#两种提供依赖方式" aria-hidden="true" class="header-anchor">#</a> 两种提供依赖方式</h3> <p>Dagger2可通过两种方式来提供依赖：</p> <ol><li><p>在类的构造函数上使用<code>@Inject</code>。</p></li> <li><p>创建用<code>@Module</code>标记的类和定义用<code>@Provides</code>标记的方法，每个<code>@Provides</code>方法提供依赖。</p></li></ol> <p><code>@Inject</code>方式用于开发者自己编写的具体类对外提供依赖。而<code>@Module</code>&amp;<code>@Provides</code>用于接口或第三方库对外提供依赖。</p> <p>其实，<code>@Module</code>&amp;<code>@Provides</code>方式是对<code>@Inject</code>方式“无法在提供方的构造函数上添加<code>@Inject</code>”这个缺点的弥补。</p> <ol><li><p>因为接口没有构造函数，无法使用<code>@Inject</code>来提供依赖。</p></li> <li><p>因为开发者无法修改第三方库的源码，无法在第三方库中的某个类的构造函数上添加<code>@Inject</code>。</p></li></ol> <p><code>@Inject</code>方式和<code>@Module</code>&amp;<code>@Provides</code>方式都可以提供依赖，那么Dagger2查找依赖的具体规则为：</p> <ol><li><p>查找<code>@Module</code>标记的类中是否存在提供对应依赖的<code>@Provides</code>方法。</p></li> <li><p>若在步骤1中存在提供对应依赖的<code>@Provides</code>方法，查看该方法是否存在参数。</p> <ol><li><p>若存在参数，则从步骤1开始依次查找依赖来初始化每个参数。</p></li> <li><p>若不存在参数，则直接初始化该类实例，完成一次依赖注入。</p></li></ol></li> <li><p>若在步骤1中不存在提供对应依赖的<code>@Provides</code>方法，则查找<code>@Inject</code>标注的构造函数。</p></li> <li><p>若在步骤3中存在提供对应依赖的构造函数，查看该构造函数是否存在参数。</p> <ol><li><p>若存在参数，则从步骤1开始依次查找依赖来初始化每个参数。</p></li> <li><p>若不存在参数，则直接初始化该类实例，完成一次依赖注入。</p></li></ol></li></ol> <p>注意，不管是哪种提供依赖方式，都需要使用<code>@Component</code>来作为依赖方和提供方之间的桥梁。</p> <h3 id="inject提供依赖"><a href="#inject提供依赖" aria-hidden="true" class="header-anchor">#</a> <code>@Inject</code>提供依赖</h3> <p>Car类是依赖需求方，Engine是依赖提供方，CarComponent接口是它们的桥梁。通过<code>@Inject</code>标注Engine的构造函数来提供依赖。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Car.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token comment">// Car依赖Engine</span>
    <span class="token annotation punctuation">@Inject</span>
    Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DaggerCarComponent<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> Engine <span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>engine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Engine.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Inject</span>
    <span class="token function">Engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sout</span><span class="token punctuation">(</span><span class="token string">&quot;引擎运行中...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarComponent.java*/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>注意，使用<code>@Inject</code>标注的成员变量，不能用private修饰符。</p> <h3 id="module-provides提供依赖"><a href="#module-provides提供依赖" aria-hidden="true" class="header-anchor">#</a> <code>@Module</code>&amp;<code>@Provides</code>提供依赖</h3> <p>与上面的例子类似，区别在于通过<code>@Module</code>和<code>@Provides</code>来提供依赖。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Car.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token comment">// Car依赖Engine</span>
    <span class="token annotation punctuation">@Inject</span>
    Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DaggerCarComponent<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">carModule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CarModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> Engine <span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>engine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Engine.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token comment">// 此处没有@Inject</span>
    <span class="token function">Engine</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sout</span><span class="token punctuation">(</span><span class="token string">&quot;引擎运行中...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarModule.java*/</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarModule</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token function">CarModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 依赖String对象的提供方</span>
    <span class="token comment">// 此处用于解决下面provideEngine方法的所需String参数。</span>
    <span class="token annotation punctuation">@Provides</span>
    String <span class="token function">provideEngineName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;宝马引擎&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 依赖Engine对象的提供方</span>
    <span class="token annotation punctuation">@Provides</span>
    Engine <span class="token function">provideEngine</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarComponent.java*/</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span>CarModule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="区分提供方"><a href="#区分提供方" aria-hidden="true" class="header-anchor">#</a> 区分提供方</h2> <p>在使用<code>@Module</code>类和<code>@Provides</code>方法来实现依赖的提供方时，方法名可随便定义（但一般为provideXxx），但返回值的类型要谨慎，这是因为Dagger2是根据这个方法的返回值类型来决定它为哪个<code>@Inject</code>标记的变量提供依赖。</p> <p>如果有多个方法的返回值的类型相同，Dagger2就无法识别出到底哪个方法为哪个<code>@Inject</code>变量提供依赖了。此时需要使用<code>@Named</code>或<code>@Qualifier</code>自定义注解来区分不同的依赖提供方。</p> <h3 id="named"><a href="#named" aria-hidden="true" class="header-anchor">#</a> <code>@Named</code></h3> <p><code>@Named</code>就是<code>javax.inject.Named</code>注解接口。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Qualifier</span> <span class="token comment">// 注明是Qualifier</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Named</span> <span class="token punctuation">{</span>
    String <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以下使用<code>@Named(&quot;name&quot;)</code>来区分不同的依赖提供方。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarModule.java*/</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarModule</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token function">CarModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Named</span><span class="token punctuation">(</span><span class="token string">&quot;BWM&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Provides</span>
    Engine <span class="token function">provideBWMEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token string">&quot;宝马引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Named</span><span class="token punctuation">(</span><span class="token string">&quot;Benz&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Provides</span>
    Engine <span class="token function">provideBenzEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Car.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token comment">// 若是Kotlin代码，此处改为@field:[Named(&quot;BWM&quot;)]</span>
    <span class="token annotation punctuation">@Named</span><span class="token punctuation">(</span><span class="token string">&quot;BWM&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 依赖“宝马引擎”的Engine</span>
    <span class="token annotation punctuation">@Inject</span>
    Engine engine<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DaggerCarComponent<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">carModule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CarModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> Engine <span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>engine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="qualifier"><a href="#qualifier" aria-hidden="true" class="header-anchor">#</a> <code>@Qualifier</code></h3> <p><code>@Qualifier</code>不能单独使用，它是用来自定义一个用于区分不同的依赖提供方的注解接口。<code>@Named</code>就是<code>@Qualifier</code>的一个具体实现。</p> <p>以下使用<code>@Qualifier</code>自定义注解来区分不同的依赖提供方。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*BMW.java*/</span>
<span class="token annotation punctuation">@Qualifier</span> <span class="token comment">// 注明是Qualifier</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">BMW</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Benz.java*/</span>
<span class="token annotation punctuation">@Qualifier</span> <span class="token comment">// 注明是Qualifier</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Benz</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarModule.java*/</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarModule</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token function">CarModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@BMW</span>
    <span class="token annotation punctuation">@Provides</span>
    Engine <span class="token function">provideBWMEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token string">&quot;宝马引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Benz</span>
    <span class="token annotation punctuation">@Provides</span>
    Engine <span class="token function">provideBenzEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Car.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@BWM</span> <span class="token comment">// 依赖“宝马引擎”的Engine</span>
    <span class="token annotation punctuation">@Inject</span>
    Engine engine<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="限定作用域"><a href="#限定作用域" aria-hidden="true" class="header-anchor">#</a> 限定作用域</h2> <h3 id="singleton"><a href="#singleton" aria-hidden="true" class="header-anchor">#</a> <code>@Singleton</code></h3> <p>实现全局单例。实际上它是否能提供全局单例要取决于对应的Component类是否为一个全局对象。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*App.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    AppComponent appComponent<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// AppComponent在自定义Application类中初始化，在整个进程中是单例。</span>
        appComponent <span class="token operator">=</span> DaggerAppComponent<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> AppComponent <span class="token function">getAppComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> appComponent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*AppComponent.java*/</span>
<span class="token annotation punctuation">@Singleton</span> <span class="token comment">// Component桥梁使用@Singleton标注</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span>AppModule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>

    OkHttpClient <span class="token function">okHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Singleton</span> <span class="token comment">// 依赖提供方使用@Singleton标注</span>
    <span class="token annotation punctuation">@Provides</span>
    <span class="token keyword">public</span> OkHttpClient <span class="token function">provideClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*MainActivity.java中的示例代码*/</span>
AppComponent appComponent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token function">getApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAppComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印两次&quot;创建&quot;的OkHttpClient对象，发现都是同一个实例。</span>
OkHttpClient client1 <span class="token operator">=</span> appComponent<span class="token punctuation">.</span><span class="token function">okHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;client1: &quot;</span> <span class="token operator">+</span> client1<span class="token punctuation">)</span><span class="token punctuation">;</span>
OkHttpClient client2 <span class="token operator">=</span> appComponent<span class="token punctuation">.</span><span class="token function">okHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;client2: &quot;</span> <span class="token operator">+</span> client2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="scope"><a href="#scope" aria-hidden="true" class="header-anchor">#</a> <code>@Scope</code></h3> <p>通过<code>@Scope</code>自定义注解来限定作用域，实现局部的单例。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarScope.java*/</span>
<span class="token annotation punctuation">@Scope</span> <span class="token comment">// 注明是Scope</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">CarScope</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarModule.java*/</span>
<span class="token annotation punctuation">@CarScope</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarModule</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*CarComponent.java*/</span>
<span class="token annotation punctuation">@CarScope</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span>CarModule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>Car car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="component"><a href="#component" aria-hidden="true" class="header-anchor">#</a> Component</h2> <h3 id="component之间的依赖"><a href="#component之间的依赖" aria-hidden="true" class="header-anchor">#</a> Component之间的依赖</h3> <p>在实际开发中，每个Component类负责一个模块的功能，它们之间可通过dependencies依赖来关联，实现多个模块功能的集成。</p> <p>进一步扩展上面&quot;限定作用域&quot;章节的&quot;<code>@Singleton</code>&quot;章节的代码来讲解“Component之间的依赖”。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*ApiService.java*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> OkHttpClient client<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ApiService</span><span class="token punctuation">(</span>OkHttpClient client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> client<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*UserScope.java*/</span>
<span class="token annotation punctuation">@Scope</span> <span class="token comment">// 注明是Scope</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">UserScope</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*UserModule*/</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserModule</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处的OkHttpClient参数依赖由AppComponent来提供。</span>
    <span class="token annotation punctuation">@Provides</span>
    <span class="token annotation punctuation">@UserScope</span>
    <span class="token keyword">public</span> ApiService <span class="token function">provideApiService</span><span class="token punctuation">(</span>OkHttpClient client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiService</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*UserComponent*/</span>
<span class="token annotation punctuation">@UserScope</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span>UserModule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> dependencies <span class="token operator">=</span> <span class="token punctuation">{</span>AppComponent<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>MainActivity activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*MainActivity.java中的示例代码*/</span>
<span class="token annotation punctuation">@Inject</span>
ApiService apiService<span class="token punctuation">;</span>

App app <span class="token operator">=</span> <span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token function">getApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// UserComponent关联UserModule，依赖AppComponent。</span>
DaggerUserComponent<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">userModule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">appComponent</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getAppComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

apiService<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注意，“被依赖Component”必须定义接口对外提供“依赖Component”所需的对象。如AppComponent必须定义接口<code>OkHttpClient okHttpClient();</code>对外提供OkHttpClient对象。</p> <h3 id="subcomponent"><a href="#subcomponent" aria-hidden="true" class="header-anchor">#</a> Subcomponent</h3> <p>Subcomponent同时具备两种不同生命周期的Scope，即Subcomponent具备父Component的Scope，也具备了自己的Scope。</p> <p>Subcomponent的Scope范围小于父Component。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*FatherComponent.java*/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Singleton</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FatherComponent</span> <span class="token punctuation">{</span>
    <span class="token comment">// 与Subcomponent建立关联</span>
    ChildComponent <span class="token function">getChildComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*ChildScope.java*/</span>
<span class="token annotation punctuation">@Scope</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">ChildScope</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*UtilModule.java*/</span>
<span class="token annotation punctuation">@Module</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UtilModule</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ChildScope</span>
    <span class="token annotation punctuation">@Provides</span>
    <span class="token keyword">public</span> Gson <span class="token function">getGson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*ChildComponent.java*/</span>
<span class="token annotation punctuation">@Subcomponent</span><span class="token punctuation">(</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span>UtilModule<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ChildScope</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChildComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span>SubcomponentActivity activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*SubcomponentActivity.java*/</span>
DaggerFatherComponent<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Inject</span>
Gson gson<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="lazy与provider"><a href="#lazy与provider" aria-hidden="true" class="header-anchor">#</a> Lazy与Provider</h2> <p><code>dagger.Lazy</code>接口，用于注入Lazy元素。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Lazy.java*/</span>
<span class="token keyword">package</span> dagger<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Lazy</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    T <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*示例代码*/</span>
<span class="token annotation punctuation">@Inject</span>
Lazy<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> lazyUser<span class="token punctuation">;</span>
<span class="token comment">// 当调用其`get()`才会创建实例，每次`get()`返回的都是同一个对象。</span>
User user <span class="token operator">=</span> lazyUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>javax.inject.Provider</code>接口，用于注入Provider元素。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*Provider.java*/</span>
<span class="token keyword">package</span> javax<span class="token punctuation">.</span>inject<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Provider</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    T <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*示例代码*/</span>
<span class="token annotation punctuation">@Inject</span>
Provider<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> providerUser<span class="token punctuation">;</span>
<span class="token comment">// 当调用其`get()`才会创建实例。</span>
<span class="token comment">// 每次`get()`都会强制调用Module的@Provides方法。</span>
<span class="token comment">// 根据@Provides方法的具体实现，可能返回同一个对象，也可能不是。</span>
User user <span class="token operator">=</span> providerUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="dagger2注意事项"><a href="#dagger2注意事项" aria-hidden="true" class="header-anchor">#</a> Dagger2注意事项</h2> <h3 id="component类"><a href="#component类" aria-hidden="true" class="header-anchor">#</a> Component类</h3> <p>Component类的inject方法接收父类类型参数，若调用时传入的是子类型对象，则无法注入。</p> <p>同一个类不能被多个Component类同时注入。</p> <p>Component类关联的各Module类中不能有重复的provides方法。</p> <p><code>@Singleton</code>的生命周期依附于component，同一个module provide singleton，不同component也是不同的。</p> <h3 id="module类"><a href="#module类" aria-hidden="true" class="header-anchor">#</a> Module类</h3> <p>若Module类的provide方法使用了scope，那么与它关联的Component类就必须使用同一个scope。</p> <p>若Module类的provide方法没有使用了scope，那么与它关联的Component类是否使用scope都可以。</p> <h3 id="scope注解"><a href="#scope注解" aria-hidden="true" class="header-anchor">#</a> scope注解</h3> <p>Component类dependencies的其他Component类，它们的scope不能与原Component类的scope相同，即有依赖关系的Component类之间的scope注解必须不同。</p> <p>Singleton组件不能依赖其他scope组件，只能其他scope组件依赖Singleton组件。</p> <p>没有scope注解的Component类不能依赖有scope注解的Component类。</p> <p>一个Component类不能同时有多个scope注解（SubComponent除外）。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/android/注解处理.html" class="prev">
          注解处理
        </a></span> <span class="next"><a href="/android/Activity生命周期的源码分析.html">
          Activity生命周期的源码分析
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/15.e903c1ca.js" defer></script><script src="/assets/js/app.bb1fe17d.js" defer></script>
  </body>
</html>
