(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{199:function(a,t,s){"use strict";s.r(t);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"final、finally、finalize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final、finally、finalize","aria-hidden":"true"}},[a._v("#")]),a._v(" final、finally、finalize")]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#final"}},[a._v("final")]),s("ul",[s("li",[s("a",{attrs:{href:"#概述"}},[a._v("概述")])]),s("li",[s("a",{attrs:{href:"#final类"}},[a._v("final类")])]),s("li",[s("a",{attrs:{href:"#final方法"}},[a._v("final方法")])]),s("li",[s("a",{attrs:{href:"#final变量"}},[a._v("final变量")])]),s("li",[s("a",{attrs:{href:"#immutable类的实现"}},[a._v("immutable类的实现")])])])]),s("li",[s("a",{attrs:{href:"#finally"}},[a._v("finally")]),s("ul",[s("li",[s("a",{attrs:{href:"#概述"}},[a._v("概述")])]),s("li",[s("a",{attrs:{href:"#try-with-resources"}},[a._v("try-with-resources")])]),s("li",[s("a",{attrs:{href:"#不会被执行的finally"}},[a._v("不会被执行的finally")])]),s("li",[s("a",{attrs:{href:"#finally与return"}},[a._v("finally与return")])])])]),s("li",[s("a",{attrs:{href:"#finalize"}},[a._v("finalize")]),s("ul",[s("li",[s("a",{attrs:{href:"#概述"}},[a._v("概述")])]),s("li",[s("a",{attrs:{href:"#finalize的原理"}},[a._v("finalize的原理")])]),s("li",[s("a",{attrs:{href:"#finalize的缺点"}},[a._v("finalize的缺点")])])])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"final"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final","aria-hidden":"true"}},[a._v("#")]),a._v(" final")]),a._v(" "),s("h3",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),s("p",[a._v("final可以用来修饰类、方法、变量。")]),a._v(" "),s("h3",{attrs:{id:"final类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final类","aria-hidden":"true"}},[a._v("#")]),a._v(" final类")]),a._v(" "),s("p",[a._v("final修饰的类不可以被继承。")]),a._v(" "),s("h3",{attrs:{id:"final方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final方法","aria-hidden":"true"}},[a._v("#")]),a._v(" final方法")]),a._v(" "),s("p",[a._v("final修饰的方法是不可以被重写的。")]),a._v(" "),s("h3",{attrs:{id:"final变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final变量","aria-hidden":"true"}},[a._v("#")]),a._v(" final变量")]),a._v(" "),s("p",[a._v("final修饰的变量是不可以被修改的。")]),a._v(" "),s("p",[a._v("注意，final并不是immutable。如果final修饰的变量是一个对象，final只能保证这个变量的对象引用不会改变，但对象本身是可以被修改的。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("final")]),a._v(" List"),s("span",{attrs:{class:"token generics function"}},[s("span",{attrs:{class:"token punctuation"}},[a._v("<")]),a._v("String"),s("span",{attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" strList "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{attrs:{class:"token class-name"}},[a._v("ArrayList")]),s("span",{attrs:{class:"token operator"}},[a._v("<")]),s("span",{attrs:{class:"token operator"}},[a._v(">")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nstrList"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("add")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v('"Hello"')]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nstrList"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("add")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v('"world"')]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"immutable类的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#immutable类的实现","aria-hidden":"true"}},[a._v("#")]),a._v(" immutable类的实现")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("将class自身声明为final，防止别人通过继承扩展来绕过限制。")])]),a._v(" "),s("li",[s("p",[a._v("将所有成员变量定义为private final，并且不要实现setter方法。")])]),a._v(" "),s("li",[s("p",[a._v("构造对象时，成员变量使用深度拷贝来初始化，而不是直接赋值。这是一种防御措施，因为你无法确定输入对象不被其他人修改。")])]),a._v(" "),s("li",[s("p",[a._v("如果需要实现getter方法，或者其他可能返回内部状态的方法，使用copy-on-write原则，创建一份副本返回。")])])]),a._v(" "),s("h2",{attrs:{id:"finally"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finally","aria-hidden":"true"}},[a._v("#")]),a._v(" finally")]),a._v(" "),s("h3",{attrs:{id:"概述-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述-2","aria-hidden":"true"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),s("p",[a._v("finally是Java保证重点代码一定要被执行的一种机制。")]),a._v(" "),s("p",[a._v("在实际开发中，常使用"),s("code",[a._v("try-finally")]),a._v("或"),s("code",[a._v("try-catch-finally")]),a._v("来进行类似关闭JDBC连接、保证unlock等动作。")]),a._v(" "),s("h3",{attrs:{id:"try-with-resources"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#try-with-resources","aria-hidden":"true"}},[a._v("#")]),a._v(" "),s("code",[a._v("try-with-resources")])]),a._v(" "),s("p",[a._v("其实，如果是关闭实现了"),s("code",[a._v("Closeable")]),a._v("或"),s("code",[a._v("AutoCloseable")]),a._v("接口的资源，推荐使用JDK7新增的"),s("code",[a._v("try-with-resources")]),a._v("来完成，避免书写冗余代码。")]),a._v(" "),s("h3",{attrs:{id:"不会被执行的finally"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不会被执行的finally","aria-hidden":"true"}},[a._v("#")]),a._v(" 不会被执行的finally")]),a._v(" "),s("p",[a._v("注意，下面的finally中的代码不会被执行。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{attrs:{class:"token comment"}},[a._v("// 业务处理")]),a._v("\n    System"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("exit")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token number"}},[a._v("1")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{attrs:{class:"token keyword"}},[a._v("finally")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    System"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("println")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v('"Print from finally"')]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"finally与return"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finally与return","aria-hidden":"true"}},[a._v("#")]),a._v(" finally与return")]),a._v(" "),s("p",[a._v("如果try语句中有return，会先将返回值保存在一个局部变量中，再执行finally语句，最后返回之前保存的局部变量。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("testReturnInTryClause")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{attrs:{class:"token keyword"}},[a._v("int")]),a._v(" x "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token number"}},[a._v("1")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{attrs:{class:"token operator"}},[a._v("++")]),a._v("x"),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{attrs:{class:"token keyword"}},[a._v("finally")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{attrs:{class:"token operator"}},[a._v("++")]),a._v("x"),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[a._v("int")]),a._v(" y "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("testReturnInTryClause")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{attrs:{class:"token comment"}},[a._v("// 2")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"finalize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finalize","aria-hidden":"true"}},[a._v("#")]),a._v(" finalize")]),a._v(" "),s("h3",{attrs:{id:"概述-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述-3","aria-hidden":"true"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),s("p",[a._v("finalize是基础类"),s("code",[a._v("java.lang.Object")]),a._v("的一个方法。")]),a._v(" "),s("p",[a._v("它的设计目的是保证对象在被垃圾收集前完成特定资源的回收。")]),a._v(" "),s("h3",{attrs:{id:"finalize的原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finalize的原理","aria-hidden":"true"}},[a._v("#")]),a._v(" finalize的原理")]),a._v(" "),s("p",[a._v("垃圾收集器在回收一个对象前，会先判断此对象是否有必要执行"),s("code",[a._v("finalize()")]),a._v("：该对象的"),s("code",[a._v("finalize()")]),a._v("被重写，而且JVM之前没有执行过它的"),s("code",[a._v("finalize()")]),a._v("。")]),a._v(" "),s("p",[a._v("若被回收对象的"),s("code",[a._v("finalize()")]),a._v("需要被执行，那么它就会被放置在一个叫做F-Queue的队列中，稍后JVM的Finalizer线程会执行这个队列中的各个对象的"),s("code",[a._v("finalize()")]),a._v("。而这个对象会在下一次垃圾收集时才会被回收。")]),a._v(" "),s("h3",{attrs:{id:"finalize的缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finalize的缺点","aria-hidden":"true"}},[a._v("#")]),a._v(" finalize的缺点")]),a._v(" "),s("p",[a._v("从垃圾回收的角度来看：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("finalize被设计成在对象被垃圾收集前调用，JVM要对它进行额外处理。")])]),a._v(" "),s("li",[s("p",[a._v("因此，finalize成为了快速垃圾回收的阻碍者，它会拖慢了垃圾收集，可能会导致大量“无用”对象的堆积，最终也许会导致OOM。")])])]),a._v(" "),s("p",[a._v("从资源回收的角度来看：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("资源是有限的，而垃圾收集的时间是不可预测的，如果依靠finalize去释放资源，可能会极大加剧资源的占用。")])]),a._v(" "),s("li",[s("p",[a._v("应该使用finally等机制实现“资源用完即释放”，最多让finalize作为保底的措施。")])]),a._v(" "),s("li",[s("p",[a._v("finalize还会掩盖资源回收时的出错信息，生吞异常。")])])]),a._v(" "),s("p",[a._v("finalize机制现在已经不推荐使用，并且在"),s("strong",[a._v("JDK9")]),a._v("开始被标记为deprecated。")])])}],!1,null,null,null);e.options.__file="final、finally、finalize.md";t.default=e.exports}}]);