(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{235:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"spring-boot部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot部署","aria-hidden":"true"}},[t._v("#")]),t._v(" Spring Boot部署")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#spring-boot部署方式"}},[t._v("Spring Boot部署方式")])]),s("li",[s("a",{attrs:{href:"#部署到应用服务器"}},[t._v("部署到应用服务器")]),s("ul",[s("li",[s("a",{attrs:{href:"#构建war文件"}},[t._v("构建war文件")])]),s("li",[s("a",{attrs:{href:"#创建生产profile"}},[t._v("创建生产Profile")])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"spring-boot部署方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot部署方式","aria-hidden":"true"}},[t._v("#")]),t._v(" Spring Boot部署方式")]),t._v(" "),s("p",[t._v("Spring Boot应用程序有多种构建和运行方式：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在IDE中运行应用程序。")])]),t._v(" "),s("li",[s("p",[t._v("使用Maven的"),s("code",[t._v("spring-boot:run")]),t._v("或Gradle的"),s("code",[t._v("bootRun")]),t._v("在命令行里运行。")])]),t._v(" "),s("li",[s("p",[t._v("使用Maven或Gradle生成可运行的jar文件，随后在命令行中运行。")])]),t._v(" "),s("li",[s("p",[t._v("使用Spring Boot CLI在命令行中运行Groovy脚本。")])]),t._v(" "),s("li",[s("p",[t._v("使用Spring Boot CLI来生成可运行的jar文件，随后在命令行中运行。")])])]),t._v(" "),s("p",[t._v("Spring Boot应用程序有以下几种打包方式。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("部署产物")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("产生方式")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("目标环境")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Groovy源码")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("手写")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Cloud Foundry、容器部署（比如Docker）")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("可执行jar")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Maven、Gradle或Spring Boot CLI")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("云环境（Cloud Foundry和Heroku）、容器部署（比如Docker）")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("war")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Maven或Gradle")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Java应用服务器（比如Tomcat）、云环境（Cloud Foundry）")])])])]),t._v(" "),s("h2",{attrs:{id:"部署到应用服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署到应用服务器","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署到应用服务器")]),t._v(" "),s("p",[t._v("归功于Spring Boot的自动配置功能，我们不需要创建"),s("code",[t._v("web.xml")]),t._v("文件或Servlet初始化类来声明Spring MVC DispatcherServlet。")]),t._v(" "),s("p",[t._v("要将Spring应用程序部署到Java应用服务器中，就需要先构建出war文件。")]),t._v(" "),s("h3",{attrs:{id:"构建war文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建war文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 构建war文件")]),t._v(" "),s("p",[t._v("若使用Gradle来构建应用程序，在"),s("code",[t._v("build.gradle")]),t._v("中应用war插件，并使用war配置来替换原来的jar配置。")]),t._v(" "),s("div",{staticClass:"language-gradle line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("apply plugin: 'war'\n\nwar {\n    baseName = 'readinglist'\n    version = '1.0.0'\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("但目前此war文件中没有"),s("code",[t._v("web.xml")]),t._v("文件或Servlet初始化类来启用Spring MVC DispatcherServlet。要使用Spring Boot提供的"),s("code",[t._v("SpringBootServletInitializer")]),t._v("来实现这个需求。")]),t._v(" "),s("p",[s("code",[t._v("SpringBootServletInitializer")]),t._v("是"),s("code",[t._v("WebApplicationInitializer")]),t._v("的实现。它除了配置Spring的"),s("code",[t._v("DispatcherServlet")]),t._v("，还会在Spring应用程序上下文里查找"),s("code",[t._v("Filter")]),t._v("、"),s("code",[t._v("Servlet")]),t._v("或"),s("code",[t._v("ServletContextInitializer")]),t._v("类型的Bean，把它们绑定到Servlet容器中。")]),t._v(" "),s("p",[t._v("要使用"),s("code",[t._v("SpringBootServletInitializer")]),t._v("，只需要创建它的一个子类，并重写其"),s("code",[t._v("configure()")]),t._v("来指定Spring配置类。")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* 应用程序的入口 */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("main")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    SpringApplication"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("run")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ReadingListApplication"),s("span",{attrs:{class:"token operator"}},[t._v("::")]),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("java"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v("args"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* 应用程序的旧配置类 */")]),t._v("\n"),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@SpringBootApplication")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" ReadingListApplication\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* 应用程序的新配置类 */")]),t._v("\n"),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@SpringBootApplication")]),t._v("\n"),s("span",{attrs:{class:"token annotation builtin"}},[t._v("@ServletComponentScan")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" ReadingListApplication "),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("SpringBootServletInitializer")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("configure")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("builder"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" SpringApplicationBuilder"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" SpringApplicationBuilder "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        builder"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("sources")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("javaClass"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("super")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("configure")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("builder"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("执行"),s("code",[t._v("gradle build")]),t._v("构建应用程序，会在"),s("code",[t._v("build/libs")]),t._v("目录中生成一个war文件，比如"),s("code",[t._v("readinglist-1.0.1.war")]),t._v("。")]),t._v(" "),s("p",[t._v("如果Java应用服务器是Tomcat，将该war文件拷贝到Tomcat的webapps目录下。Tomcat会检测到这个war文件，随后进行解压和安装。在浏览器上输入"),s("code",[t._v("http://<server>:<port>/readinglist-1.0.0")]),t._v("进行访问。")]),t._v(" "),s("h3",{attrs:{id:"创建生产profile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建生产profile","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建生产Profile")]),t._v(" "),s("p",[t._v("之前的ReadingList项目，Spring Boot自动配置了一个指向嵌入式H2数据库的"),s("code",[t._v("DataSource")]),t._v("类型Bean。这个Bean是一个数据库连接池，通常是"),s("code",[t._v("org.apache.tomcat.jdbc.pool.DataSource")]),t._v("。")]),t._v(" "),s("p",[t._v("如果要在生产环境中使用PostgreSQL数据库，就需要声明自己的"),s("code",[t._v("DataSource")]),t._v("类型Bean，于是，默认自动配置的"),s("code",[t._v("DataSource")]),t._v("类型Bean就会无效。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Profile")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"production"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" DataSource "),s("span",{attrs:{class:"token function"}},[t._v("dataSource")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tDataSource ds "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("DataSource")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tds"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setDriverClassName")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"org.postgresql.Driver"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tds"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setUrl")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"jdbc:postgresql://localhost:5432/readinglist"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tds"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setUsername")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"username"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tds"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setPassword")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"password"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ds"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("也可以通过属性文件（"),s("code",[t._v("application.yml")]),t._v("或"),s("code",[t._v("application.properties")]),t._v("）来配置数据库的细节。注意是"),s("strong",[t._v("production Profile")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/* application.yml */\n\n// ... 通用Profile\n\n---\n\nspring:\n\tprofiles: production\n\tdatasource:\n\t\turl: jdbc:postgresql://localhost:5432/readinglist\n\t\tusername: username\n\t\tpassword: password\n\t\tdriver-class-name: org.postgresql.Driver\n\tjpa:\n\t\tdatabase-platform: org.hibernate.dialect.PostgreSQLDialect\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{attrs:{class:"token attr-name"}},[t._v("/*")]),t._v(" "),s("span",{attrs:{class:"token attr-value"}},[t._v("application-production.properties */")]),t._v("\n"),s("span",{attrs:{class:"token attr-name"}},[t._v("spring.datasource.url")]),s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token attr-value"}},[t._v("jdbc:postgresql://localhost:5432/readinglist")]),t._v("\n"),s("span",{attrs:{class:"token attr-name"}},[t._v("spring.datasource.username")]),s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token attr-value"}},[t._v("username")]),t._v("\n"),s("span",{attrs:{class:"token attr-name"}},[t._v("spring.datasource.password")]),s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token attr-value"}},[t._v("password")]),t._v("\n"),s("span",{attrs:{class:"token attr-name"}},[t._v("spring.datasource.driver-class-name")]),s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token attr-value"}},[t._v("org.postgresql.Driver")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("注意， "),s("code",[t._v("spring.datasource.driver-class-name")]),t._v("属性一般无需设置。Spring Boot可以根据"),s("code",[t._v("spring.datasource.url")]),t._v("属性的值做出相应推断。")]),t._v(" "),s("p",[t._v("要开启这个production Profile，需要把"),s("code",[t._v("spring.profiles.active")]),t._v("属性设置为production。也可以设置"),s("code",[t._v("SPRING_PROFILES_ACTIVE")]),t._v("环境变量为production。")])])}],!1,null,null,null);e.options.__file="Spring Boot部署.md";a.default=e.exports}}]);