(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{230:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"bean的高级装配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bean的高级装配","aria-hidden":"true"}},[s._v("#")]),s._v(" Bean的高级装配")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#环境与profile"}},[s._v("环境与Profile")]),t("ul",[t("li",[t("a",{attrs:{href:"#配置profile-bean"}},[s._v("配置profile bean")])]),t("li",[t("a",{attrs:{href:"#激活profile"}},[s._v("激活profile")])])])]),t("li",[t("a",{attrs:{href:"#条件化bean"}},[s._v("条件化Bean")])]),t("li",[t("a",{attrs:{href:"#自动装配的歧义性"}},[s._v("自动装配的歧义性")]),t("ul",[t("li",[t("a",{attrs:{href:"#首选bean"}},[s._v("首选bean")])]),t("li",[t("a",{attrs:{href:"#限定符"}},[s._v("限定符")])])])]),t("li",[t("a",{attrs:{href:"#bean的作用域"}},[s._v("bean的作用域")]),t("ul",[t("li",[t("a",{attrs:{href:"#作用域种类"}},[s._v("作用域种类")])]),t("li",[t("a",{attrs:{href:"#作用域代理"}},[s._v("作用域代理")])])])]),t("li",[t("a",{attrs:{href:"#运行时值注入"}},[s._v("运行时值注入")]),t("ul",[t("li",[t("a",{attrs:{href:"#属性占位符"}},[s._v("属性占位符")])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"环境与profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境与profile","aria-hidden":"true"}},[s._v("#")]),s._v(" 环境与Profile")]),s._v(" "),t("h3",{attrs:{id:"配置profile-bean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置profile-bean","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置profile bean")]),s._v(" "),t("p",[s._v("Spring 3.1引入了profile bean功能：为某个bean指定它所属的profile环境，当该profile处于active状态时，这个bean定义才有效。")]),s._v(" "),t("p",[s._v("在Java配置中，可以使用"),t("code",[s._v("@Profile")]),s._v("注解来指定某个bean属于哪一个profile。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Configuration")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Profile")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"dev"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" DevelopmentProfileConfig "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("在上面的例子中，将"),t("code",[s._v("@Profile")]),s._v("注解应用在类级别上，表示这个配置类中定义的bean只有在dev profile激活时才有效。若dev profile没有激活，这个类中带有"),t("code",[s._v("@Bean")]),s._v("注解的方法都会被忽略。")]),s._v(" "),t("p",[s._v("在Spring 3.1中，只能在类级别上使用"),t("code",[s._v("@Profile")]),s._v("注解。从Spring 3.2开始，可以在方法级别上使用。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Configuration")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" DevelopmentProfileConfig "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Profile")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"dev"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("embeddedDataSource")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" DataSource "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Profile")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"prod"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("jndiDataSource")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" DataSource "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("可以通过"),t("code",[s._v("<beans>")]),s._v("元素的"),t("strong",[s._v("profile属性")]),s._v("，在XML中配置profile bean。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("beans")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("profile")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dev"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- ... --\x3e")]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("beans")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("可以在XML文件的根"),t("code",[s._v("<beans>")]),s._v("元素中嵌套定义"),t("code",[s._v("<beans>")]),s._v("元素，每个"),t("code",[s._v("<beans>")]),s._v("元素负责一个profile环境的定义，这样就能够将所有profile bean定义放在同一个XML文件中。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("beans")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("beans")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("profile")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dev"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- ... --\x3e")]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("beans")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("beans")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("profile")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("prod"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- ... --\x3e")]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("beans")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("beans")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"激活profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#激活profile","aria-hidden":"true"}},[s._v("#")]),s._v(" 激活profile")]),s._v(" "),t("p",[s._v("Spring依赖"),t("code",[s._v("spring.profiles.active")]),s._v("和"),t("code",[s._v("spring.profiles.default")]),s._v("这两个独立的属性来确定哪个profile是激活的。")]),s._v(" "),t("ol",[t("li",[s._v("如果设置了"),t("code",[s._v("spring.profiles.active")]),s._v("，那么就用它的值来确定要激活的profile。")]),s._v(" "),t("li",[s._v("如果没有设置"),t("code",[s._v("spring.profiles.active")]),s._v("，就查找"),t("code",[s._v("spring.profiles.default")]),s._v("值。")]),s._v(" "),t("li",[s._v("如果两个值都没有设置，那就没有激活的profile，因此只会创建那些没有定义在profile中的bean。")])]),s._v(" "),t("p",[s._v("有多种方式来设置这两个属性：")]),s._v(" "),t("ul",[t("li",[s._v("作为DispatcherServlet的初始化参数。")])]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- web.xml --\x3e")]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-app")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("appServlet"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("servlet-class")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            org.springframework.web.servlet.DispatcherServlet\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet-class")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("init-param")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring.profiles.default"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("param-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param-value")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("dev"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("param-value")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("init-param")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("servlet")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-app")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("作为Web应用的上下文参数。")])]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- web.xml --\x3e")]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-app")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("context-param")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring.profiles.default"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("param-name")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param-value")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("dev"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("param-value")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("context-param")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-app")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("作为JNDI条目。")])]),s._v(" "),t("li",[t("p",[s._v("作为环境变量。")])]),s._v(" "),t("li",[t("p",[s._v("作为JVM的系统属性。")])]),s._v(" "),t("li",[t("p",[s._v("在集成测试类上，使用"),t("code",[s._v("@ActiveProfiles")]),s._v("注解来设置。")])])]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@RunWith")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SpringJUnit4ClassRunner"),t("span",{attrs:{class:"token operator"}},[s._v("::")]),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@ContextConfiguration")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("classes "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SystemConfig"),t("span",{attrs:{class:"token operator"}},[s._v("::")]),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@ActiveProfiles")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{attrs:{class:"token string"}},[s._v('"dev"')]),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" CDPlayerTest "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("其实，这两个属性都可以同时赋予多个profile名称，用逗号分割。")]),s._v(" "),t("h2",{attrs:{id:"条件化bean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#条件化bean","aria-hidden":"true"}},[s._v("#")]),s._v(" 条件化Bean")]),s._v(" "),t("p",[s._v("Spring 4引入了一个新的"),t("code",[s._v("@Conditional")]),s._v("注解，它和"),t("code",[s._v("@Bean")]),s._v("注解一起使用。如果指定的条件成立，就会创建对应的Bean，否则会忽略这个Bean定义。")]),s._v(" "),t("p",[t("code",[s._v("@Conditional")]),s._v("注解接收一个Class类为参数，该类可以是任意实现了Condition接口的类型。这个Condition实现类要实现"),t("code",[s._v("matches()")]),s._v("方法，此方法的Boolean结果决定是否创建"),t("code",[s._v("@Conditional")]),s._v("注解对应的Bean。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" org"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Condition\n"),t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" org"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ConditionContext\n"),t("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" org"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AnnotatedTypeMetadata\n\n"),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" MagicExistsCondition "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Condition "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("matches")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" ConditionContext"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metadata"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" AnnotatedTypeMetadata"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Boolean "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token comment"}},[s._v("// 检查环境中是否存在magic属性")]),s._v("\n        "),t("span",{attrs:{class:"token keyword"}},[s._v("val")]),s._v(" env "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environment\n        "),t("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" env"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("containsProperty")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"magic"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("// MagicExistsCondition的matches方法返回true时，才会创建MagicBean")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Conditional")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MagicExistsCondition"),t("span",{attrs:{class:"token operator"}},[s._v("::")]),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("magicBean")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" MagicBean "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("MagicBean")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("善于利用"),t("code",[s._v("matches()")]),s._v("方法中的ConditionContext和AnnotatedTypeMetadata对象来做条件判断的决策。")]),s._v(" "),t("p",[s._v("通过ConditionContext，可做到如下几点：")]),s._v(" "),t("ul",[t("li",[s._v("借助"),t("code",[s._v("getRegistry()")]),s._v("返回的BeanDefinitionRegistry检查bean定义。")]),s._v(" "),t("li",[s._v("借助"),t("code",[s._v("getBeanFactory()")]),s._v("返回的ConfigurableListableBeanFactory检查bean是否存在，甚至探查bean的属性。")]),s._v(" "),t("li",[s._v("借助"),t("code",[s._v("getEnvironment()")]),s._v("返回的Environment检查环境变量是否存在指定属性，以及其值是什么。")]),s._v(" "),t("li",[s._v("借助"),t("code",[s._v("getResourceLoader()")]),s._v("返回的ResourceLoader读取并探查所加载的资源。")]),s._v(" "),t("li",[s._v("借助"),t("code",[s._v("getClassLoader()")]),s._v("返回的ClassLoader加载并检查类是否存在。")])]),s._v(" "),t("h2",{attrs:{id:"自动装配的歧义性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自动装配的歧义性","aria-hidden":"true"}},[s._v("#")]),s._v(" 自动装配的歧义性")]),s._v(" "),t("p",[s._v("仅有一个bean匹配时，Spring自动装配能正常工作。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cake "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"Cake"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" dessert"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("如果有多于一个的bean能够匹配时，这种歧义性会阻碍Spring自动装配，并抛出NoUniqueBeanDefinitionException。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cake "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"Cake"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cookie "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"Cookie"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" IceCream "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"IceCream"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("解决这种歧义性的方法有：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("将可选bean中的某一个设为首选（primary bean）。")])]),s._v(" "),t("li",[t("p",[s._v("使用限定符（qualifier）来帮助Spring将可选bean的范围缩小到只有一个。")])])]),s._v(" "),t("h3",{attrs:{id:"首选bean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#首选bean","aria-hidden":"true"}},[s._v("#")]),s._v(" 首选bean")]),s._v(" "),t("p",[s._v("在声明bean时，通过将其中一个可选bean设为首选bean，能够避免自动装配时的歧义性。当遇到歧义性时，Spring将会使用首选bean。")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("@Primary")]),s._v("来声明首选bean。")]),s._v(" "),t("ul",[t("li",[s._v("它能够与"),t("code",[s._v("@Component")]),s._v("组合用在组件扫描的bean上。")])]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Primary")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cake "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"Cake"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("也可以将它与"),t("code",[s._v("@Bean")]),s._v("组合用在Java配置的bean声明中。")])]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Primary")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" Dessert "),t("span",{attrs:{class:"token function"}},[s._v("cake")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("Cake")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果使用XML配置，可使用"),t("code",[s._v("<bean>")]),s._v("元素中的primary属性来指定首选bean。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("id")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cake"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("class")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("tech.daking.bean.Cake"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("primary")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("注意，首选bean要确保只有一个，若有多个首选bean，Spring自动装配的歧义性就再次出现。")]),s._v(" "),t("h3",{attrs:{id:"限定符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#限定符","aria-hidden":"true"}},[s._v("#")]),s._v(" 限定符")]),s._v(" "),t("p",[s._v("首选bean只能标示一个优先的可选方案，而无法将可选方案限定到唯一一个无歧义性的结果。")]),s._v(" "),t("p",[s._v("而Spring限定符能够在所有可选的bean上进行缩小范围的操作，最终能够达到只有一个bean满足所规定的限制条件。")]),s._v(" "),t("h4",{attrs:{id:"默认限定符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#默认限定符","aria-hidden":"true"}},[s._v("#")]),s._v(" 默认限定符")]),s._v(" "),t("p",[s._v("所有bean都会给定一个默认的限定符，其值与bean的ID相同。")]),s._v(" "),t("p",[t("code",[s._v("@Qualifier")]),s._v("注解可以与"),t("code",[s._v("@Autowired")]),s._v("和"),t("code",[s._v("@Inject")]),s._v("协同使用，在注入时指明要注入规定限定符的bean。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("// 创建ID为cookie的bean，因此，bean的限定符为cookie")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cookie "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"Cookie"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("// 指定注入限定符为cookie的bean")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Qualifier")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"cookie"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" Cookie"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"自定义的限定符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义的限定符","aria-hidden":"true"}},[s._v("#")]),s._v(" 自定义的限定符")]),s._v(" "),t("p",[s._v("可以为bean设置自定义的限定符，而不依赖于其bean ID。")]),s._v(" "),t("p",[s._v("在bean声明上添加"),t("code",[s._v("@Qualifier")]),s._v("注解来创建自定义的限定符。")]),s._v(" "),t("ul",[t("li",[s._v("在"),t("code",[s._v("@Component")]),s._v("的bean声明上使用"),t("code",[s._v("@Qualifier")]),s._v("创建自定义的限定符。")])]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Qualifier")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"cold"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" IceCream "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"IceCream"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("在"),t("code",[s._v("@Bean")]),s._v("的bean声明上使用"),t("code",[s._v("@Qualifier")]),s._v("创建自定义的限定符。")])]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Qualifier")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"cold"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("cold")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("IceCream")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("在注入时使用"),t("code",[s._v("@Qualifier")]),s._v("注解引用指定的自定义限定符。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Qualifier")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"cold"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cold"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"自定义的限定符注解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义的限定符注解","aria-hidden":"true"}},[s._v("#")]),s._v(" 自定义的限定符注解")]),s._v(" "),t("p",[s._v("可以创建自定义的限定符注解来表达bean所希望限定的特性。")]),s._v(" "),t("p",[s._v("首先，定义一个新的自定义的限定符注解。在定义该注解时必须添加"),t("code",[s._v("@Qualifier")]),s._v("注解，让其具有"),t("code",[s._v("@Qualifier")]),s._v("注解的特性。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Target")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AnnotationTarget"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CLASS"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" AnnotationTarget"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CONSTRUCTOR"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        AnnotationTarget"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FIELD"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" AnnotationTarget"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FUNCTION"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" AnnotationTarget"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TYPE"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Retention")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AnnotationRetention"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RUNTIME"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Qualifier")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("annotation")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cold\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("接着，为bean添加该自定义的限定符注解。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Cold")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" IceCream "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("override")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("name")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v('"IceCream"')]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("最后，在注入时使用自定义的限定符注解。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Cold")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cold"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("可同时使用多个这样的自定义的限定符注解，从而将可选范围缩小到只有一个bean满足需求。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Cold")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Creamy")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cold"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"bean的作用域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bean的作用域","aria-hidden":"true"}},[s._v("#")]),s._v(" bean的作用域")]),s._v(" "),t("h3",{attrs:{id:"作用域种类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用域种类","aria-hidden":"true"}},[s._v("#")]),s._v(" 作用域种类")]),s._v(" "),t("p",[s._v("默认情况下，Spring应用上下文中所有bean都是以单例的形式创建的。")]),s._v(" "),t("p",[s._v("Spring定义了多种作用域，可以基于它们来创建bean。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("单例（Singleton）：在整个应用中，只创建一个bean实例。")])]),s._v(" "),t("li",[t("p",[s._v("原型（Prototype）：每次注入或者通过Spring应用上下文获取时，都会创建一个新的bean实例。")])]),s._v(" "),t("li",[t("p",[s._v("会话（Session）：在Web应用中，为每个会话创建一个bean实例。")])]),s._v(" "),t("li",[t("p",[s._v("请求（Request）：在Web应用中，为每次请求创建一个bean实例。")])])]),s._v(" "),t("p",[s._v("在bean声明（"),t("code",[s._v("@Component")]),s._v("或"),t("code",[s._v("@Bean")]),s._v("）上使用"),t("code",[s._v("@Scope")]),s._v("来指定该bean的作用域。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Scope")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ConfigurableBeanFactory"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SCOPE_PROTOTYPE"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Cookie "),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Dessert "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("..")]),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("注意，"),t("em",[s._v("单例")]),s._v("和"),t("em",[s._v("原型")]),s._v("作用域分别使用Spring库中的"),t("em",[s._v("ConfigurableBeanFactory")]),s._v("类的"),t("em",[s._v("SCOPE_SINGLETON")]),s._v("和"),t("em",[s._v("SCOPE_PROTOTYPE")]),s._v("。而"),t("em",[s._v("会话")]),s._v("和"),t("em",[s._v("请求")]),s._v("作用域分别使用Spring Web库中的"),t("em",[s._v("WebApplicationContext")]),s._v("类的"),t("em",[s._v("SCOPE_SESSION")]),s._v("和"),t("em",[s._v("SCOPE_REQUEST")]),s._v("。")]),s._v(" "),t("p",[s._v("如果是XML配置，使用"),t("code",[s._v("<bean>")]),s._v("元素的"),t("strong",[s._v("scope属性")]),s._v("来指定该bean的作用域。各作用域对应的字符串分别为：singleton、prototype、session和request。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("id")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cookie"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("class")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("tech.daking.bean.Cookie"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("scope")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("prototype"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"作用域代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用域代理","aria-hidden":"true"}},[s._v("#")]),s._v(" 作用域代理")]),s._v(" "),t("p",[s._v("在Web应用中，常常使用会话或请求作用域来声明一些与用户或网络请求相关的bean。比如，购物车bean。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Scope")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" WebApplicationContext"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SCOPE_SESSION"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        proxyMode "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ScopedProxyMode"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TARGET_CLASS"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" ShoppingCart "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("..")]),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("上面的ShoppingCart bean，"),t("code",[s._v("@Scope")]),s._v("注解的value属性设为"),t("code",[s._v("WebApplicationContext.SCOPE_SESSION")]),s._v("，表明这是一个会话作用域的bean。而"),t("code",[s._v("proxyMode")]),s._v("属性是设置该bean的作用域代理，下面进行重点讲述。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Component")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" StoreService "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" shoppingCart"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" ShoppingCart\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("上面的StoreService bean是一个单例bean，会在Spring应用上下文加载时创建。当它创建时，Spring会试图将ShoppingCart bean注入到其shoppingCart字段中。但ShoppingCart bean是会话作用域，此时并不存在，要直到某个用户创建会话才会出现ShoppingCart实例。")]),s._v(" "),t("p",[s._v("另外，系统中会有多个ShoppingCart bean实例（每个用户对应一个），我们不能让某个固定的ShoppingCart bean实例注入到StoreService bean中。")]),s._v(" "),t("p",[s._v("因此，要使用"),t("strong",[s._v("作用域代理")]),s._v("机制让一个"),t("strong",[s._v("ShoppingCart bean代理")]),s._v("注入到StoreService bean中，当调用ShoppingCart的方法时，"),t("strong",[s._v("该代理会对其进行懒解析并委托给会话作用域内真正的ShoppingCart bean实例")]),s._v("来处理。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/15267167746675/15318149555135.jpg",alt:"会话或请求作用域的代理-w505"}})]),s._v(" "),t("p",[t("code",[s._v("@Scope")]),s._v("注解的proxyMode属性值为ScopedProxyMode枚举类对象，有以下几个可选值：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("DEFAULT")]),s._v("：默认代理模式。默认情况下等同于NO，除非在组件扫描指令级别中修改了默认代理模式。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("NO")]),s._v("：不创建作用域代理。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("INTERFACES")]),s._v("：利用JDK动态代理来创建一个基于接口的代理对象。若bean是接口，使用此代理模式。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("TARGET_CLASS")]),s._v("：使用CGLIB来创建一个扩展目标类的代理对象。若bean是类，使用此代理模式。")])])]),s._v(" "),t("p",[s._v("如果是XML配置，在"),t("code",[s._v("<bean>")]),s._v("元素中使用Spring aop命名空间中的"),t("code",[s._v("<aop:scoped-proxy>")]),s._v("子元素来指定作用域的代理模式。")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),t("span",{attrs:{class:"token attr-name"}},[s._v("id")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cart"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("class")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("tech.daking.bean.ShoppingCart"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n    "),t("span",{attrs:{class:"token attr-name"}},[s._v("scope")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("session"),t("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{attrs:{class:"token namespace"}},[s._v("aop:")]),s._v("scoped-proxy")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token tag"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),t("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("code",[s._v("<aop:scoped-proxy>")]),s._v("默认是使用CGLIB创建目标类的代理，可将其"),t("code",[s._v("proxy-target-class")]),s._v("属性设为false让它生成基于接口的代理。")]),s._v(" "),t("h2",{attrs:{id:"运行时值注入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时值注入","aria-hidden":"true"}},[s._v("#")]),s._v(" 运行时值注入")]),s._v(" "),t("p",[s._v("Spring的依赖注入，不仅支持将一个bean对象注入到另一个bean对象的属性或构造器参数中，还支持将一个值注入到一个bean的属性或构造器参数中。")]),s._v(" "),t("p",[s._v("Spring提供了两种在运行时注入值的方法：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("属性占位符（Property placeholder）。")])]),s._v(" "),t("li",[t("p",[s._v("Spring表达式语言（SpEL）。")])])]),s._v(" "),t("h3",{attrs:{id:"属性占位符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#属性占位符","aria-hidden":"true"}},[s._v("#")]),s._v(" 属性占位符")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("BlankDisc")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token keyword"}},[s._v("val")]),s._v(" title"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String"),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("val")]),s._v(" artist"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" String"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("play")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token function"}},[s._v("println")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"Playing '),t("span",{attrs:{class:"token interpolation variable"}},[s._v("$title")]),s._v(" by "),t("span",{attrs:{class:"token interpolation variable"}},[s._v("$artist")]),s._v('."')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# src/main/resources/app.properties\ndisc.title=Jay\ndisc.artist=Jay Chou\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Configuration")]),s._v("\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@PropertySource")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"classpath:app.properties"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" CDPlayerConfig "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" env"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" Environment\n\n    "),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Bean")]),s._v("\n    "),t("span",{attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("blankDisc")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" BlankDisc "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("BlankDisc")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                env"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("getProperty")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"disc.title"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                env"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("getProperty")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"disc.artist"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Autowired")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("lateinit")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" blankDisc"),t("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" BlankDisc\n\n"),t("span",{attrs:{class:"token annotation builtin"}},[s._v("@Test")]),s._v("\n"),t("span",{attrs:{class:"token keyword"}},[s._v("fun")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("playBlankDisc")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    blankDisc"),t("span",{attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{attrs:{class:"token function"}},[s._v("play")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{attrs:{class:"token comment"}},[s._v("// Playing Jay by Jay Chou.")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])}],!1,null,null,null);e.options.__file="Bean的高级装配.md";a.default=e.exports}}]);