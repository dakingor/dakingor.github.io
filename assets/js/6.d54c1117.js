(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{150:function(t,a,i){"use strict";i.r(a);var s=i(0),v=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"content"},[i("h1",{attrs:{id:"activity启动模式"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#activity启动模式","aria-hidden":"true"}},[t._v("#")]),t._v(" Activity启动模式")]),t._v(" "),i("p"),i("div",{staticClass:"table-of-contents"},[i("ul",[i("li",[i("a",{attrs:{href:"#任务栈"}},[t._v("任务栈")])]),i("li",[i("a",{attrs:{href:"#taskaffinity"}},[t._v("TaskAffinity")]),i("ul",[i("li",[i("a",{attrs:{href:"#taskaffinity与singletask"}},[t._v("TaskAffinity与singleTask")])]),i("li",[i("a",{attrs:{href:"#taskaffinity和allowtaskreparenting"}},[t._v("TaskAffinity和allowTaskReparenting")])])])]),i("li",[i("a",{attrs:{href:"#activity的4种启动模式"}},[t._v("Activity的4种启动模式")]),i("ul",[i("li",[i("a",{attrs:{href:"#standard"}},[t._v("standard")])]),i("li",[i("a",{attrs:{href:"#singletop"}},[t._v("singleTop")])]),i("li",[i("a",{attrs:{href:"#singletask"}},[t._v("singleTask")])]),i("li",[i("a",{attrs:{href:"#singleinstance"}},[t._v("singleInstance")])])])]),i("li",[i("a",{attrs:{href:"#指定activity的启动模式"}},[t._v("指定Activity的启动模式")])]),i("li",[i("a",{attrs:{href:"#activity的flags"}},[t._v("Activity的Flags")])])])]),i("p"),t._v(" "),i("h2",{attrs:{id:"任务栈"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#任务栈","aria-hidden":"true"}},[t._v("#")]),t._v(" 任务栈")]),t._v(" "),i("p",[t._v("Android是以栈来管理多个Activity的，根据先进先出的原则，当切换到新的Activity时，该Activity就会被压入栈，成为栈顶；当点击返回键时，栈顶的Activity出栈，紧随其后的Activity就成为新的栈顶。")]),t._v(" "),i("p",[t._v("一个手机在同一时刻会有多个任务栈，但只有一个栈在前台，其他的栈都在后台。")]),t._v(" "),i("p",[i("strong",[t._v("任务栈是跨应用的")]),t._v("，就是说任务栈并非存放唯一一个APP的所有Activity，这是为了保持用户操作的连贯性，可在APP1打开APP2像打开APP1本身的Activity一样连贯。")]),t._v(" "),i("h2",{attrs:{id:"taskaffinity"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#taskaffinity","aria-hidden":"true"}},[t._v("#")]),t._v(" TaskAffinity")]),t._v(" "),i("p",[t._v("TaskAffinity是"),i("code",[t._v("<activity>")]),t._v("的一个属性，用于标识此Activity所需要的任务栈的名字，默认值为包名。")]),t._v(" "),i("p",[t._v("TaskAffinity属性主要和singleTask启动模式或allowTaskReparenting属性配对使用，在其他情况下没有意义。")]),t._v(" "),i("h3",{attrs:{id:"taskaffinity与singletask"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#taskaffinity与singletask","aria-hidden":"true"}},[t._v("#")]),t._v(" TaskAffinity与singleTask")]),t._v(" "),i("p",[t._v("指定Activity要运行在名字和TaskAffinity相同的任务栈中。")]),t._v(" "),i("h3",{attrs:{id:"taskaffinity和allowtaskreparenting"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#taskaffinity和allowtaskreparenting","aria-hidden":"true"}},[t._v("#")]),t._v(" TaskAffinity和allowTaskReparenting")]),t._v(" "),i("p",[t._v("启动指定了TaskAffinity属性，而且"),i("code",[t._v("allowTaskReparenting = true")]),t._v("的Activity时，若发现其所需的任务栈不存在，则它可运行在当前任务栈上，即使该栈的名称与TaskAffinity属性值不同。")]),t._v(" "),i("p",[t._v("如果随后该Activity所需的任务栈（栈名与TaskAffinity属性值相同）被创建，则自动把它转移到这个任务栈上。")]),t._v(" "),i("h2",{attrs:{id:"activity的4种启动模式"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#activity的4种启动模式","aria-hidden":"true"}},[t._v("#")]),t._v(" Activity的4种启动模式")]),t._v(" "),i("h3",{attrs:{id:"standard"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#standard","aria-hidden":"true"}},[t._v("#")]),t._v(" standard")]),t._v(" "),i("p",[t._v("标准模式，系统的默认模式。")]),t._v(" "),i("p",[t._v("每次启动一个Activity都会重新创建一个新的实例。")]),t._v(" "),i("p",[t._v("standard模式的Activity默认会进入启动它的Activity所属的任务栈中。若是非Activity类型的Context来启动，就必须指定"),i("code",[t._v("FLAG_ACTIVITY_NEW_TASK")]),t._v("标志位，让待启动Activity进入一个新创建的任务栈中，这是因为"),i("strong",[t._v("非Activity类型的Context没有所属的任务栈")]),t._v("。")]),t._v(" "),i("p",[t._v("大多数Activity都是使用此启动模式。")]),t._v(" "),i("h3",{attrs:{id:"singletop"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#singletop","aria-hidden":"true"}},[t._v("#")]),t._v(" singleTop")]),t._v(" "),i("p",[t._v("栈顶复用模式。")]),t._v(" "),i("p",[t._v("若新Activity已有实例位于任务栈的栈顶，那么就不会再创建此Activity实例，而是回调其"),i("code",[t._v("onNewIntent()")]),t._v("，把当前请求的信息传递进去。")]),t._v(" "),i("p",[t._v("若新Activity已有实例但不是位于栈顶，那么会创建该Activity实例。")]),t._v(" "),i("h3",{attrs:{id:"singletask"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#singletask","aria-hidden":"true"}},[t._v("#")]),t._v(" singleTask")]),t._v(" "),i("p",[t._v("栈内复用模式。")]),t._v(" "),i("p",[t._v("启动singleTask模式的Activity的工作流程是：")]),t._v(" "),i("ol",[i("li",[i("p",[t._v("系统首先会寻找是否存在它想要的任务栈，若不存在该任务栈，则创建指定名称的任务栈，接着创建此Activity实例并放入该栈中。")])]),t._v(" "),i("li",[i("p",[t._v("若存在该任务栈，则检测此栈中是否存在此Activity实例。")])]),t._v(" "),i("li",[i("p",[t._v("若实例存在，将它上面的Activity干掉使其变成栈顶，接着调用它的"),i("code",[t._v("onNewIntent()")]),t._v("；否则，创建此Activity并放入该栈中。")])])]),t._v(" "),i("p",[t._v("常用于App的主界面，如浏览器的主界面，即不管从多少个地方启动浏览器，都只会启动一个主界面。")]),t._v(" "),i("h3",{attrs:{id:"singleinstance"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#singleinstance","aria-hidden":"true"}},[t._v("#")]),t._v(" singleInstance")]),t._v(" "),i("p",[t._v("单实例模式。")]),t._v(" "),i("p",[t._v("此模式是一种加强的singleTask模式，它除了具有singleTask模式的所有特性外，还有它只能单独地位于一个任务栈中。")]),t._v(" "),i("p",[t._v("一旦该模式的Activity实例已经存在于某个栈中，任何应用再启动该Activity时都会重用该栈中的实例(会调用实例的"),i("code",[t._v("onNewIntent()")]),t._v(")。")]),t._v(" "),i("p",[t._v("注意，singleInstance"),i("strong",[t._v("独占一个任务栈")]),t._v("。如果此模式的Activity若启动其他Activity，这个新Activity会运行在其他任务栈中。")]),t._v(" "),i("p",[t._v("常用于"),i("strong",[t._v("闹铃提醒")]),t._v("等，让多个应用共享该栈中的该Activity实例。")]),t._v(" "),i("h2",{attrs:{id:"指定activity的启动模式"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#指定activity的启动模式","aria-hidden":"true"}},[t._v("#")]),t._v(" 指定Activity的启动模式")]),t._v(" "),i("p",[t._v("可以在"),i("code",[t._v("AndroidManifest.xml")]),t._v("中指定Activity的启动模式。")]),t._v(" "),i("div",{staticClass:"language-xml line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-xml"}},[i("code",[i("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- 可选值有：standard、singleTop、singleTask、singleInstance --\x3e")]),t._v("\n"),i("span",{attrs:{class:"token tag"}},[i("span",{attrs:{class:"token tag"}},[i("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("activity")]),t._v("\n    "),i("span",{attrs:{class:"token attr-name"}},[i("span",{attrs:{class:"token namespace"}},[t._v("android:")]),t._v("launchMode")]),i("span",{attrs:{class:"token attr-value"}},[i("span",{attrs:{class:"token punctuation"}},[t._v("=")]),i("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("singleTop"),i("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),i("span",{attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br"),i("span",{staticClass:"line-number"},[t._v("2")]),i("br"),i("span",{staticClass:"line-number"},[t._v("3")]),i("br")])]),i("p",[t._v("也可以在"),i("code",[t._v("Intent")]),t._v("中设置标志位来指定Activity的启动模式。")]),t._v(" "),i("div",{staticClass:"language-java line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-java"}},[i("code",[t._v("intent"),i("span",{attrs:{class:"token punctuation"}},[t._v(".")]),i("span",{attrs:{class:"token function"}},[t._v("addFlags")]),i("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Intent"),i("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FLAG_ACTIVITY_NEW_TASK"),i("span",{attrs:{class:"token punctuation"}},[t._v(")")]),i("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br")])]),i("p",[t._v("第二种方式的优先级更高，即两种方式同时存在时，以第二种方式为准。")]),t._v(" "),i("p",[t._v("第一种方式无法为Activity设定"),i("code",[t._v("FLAG_ACTIVITY_CLEAR_TOP")]),t._v("，而第二种方式无法为Activity指定singleInstance模式。")]),t._v(" "),i("h2",{attrs:{id:"activity的flags"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#activity的flags","aria-hidden":"true"}},[t._v("#")]),t._v(" Activity的Flags")]),t._v(" "),i("p",[t._v("Intent类中定义了很多的Activity标志位，下面将介绍常用的几个。")]),t._v(" "),i("p",[t._v("用于设定Activity的启动模式：")]),t._v(" "),i("ul",[i("li",[i("p",[t._v("FLAG_ACTIVITY_NEW_TASK：其作用与"),i("code",[t._v("singleTask")]),t._v("启动模式一致。")])]),t._v(" "),i("li",[i("p",[t._v("FLAG_ACTIVITY_SINGLE_TOP：其作用与"),i("code",[t._v("singleTop")]),t._v("启动模式一致。")])])]),t._v(" "),i("p",[t._v("影响Activity的运行状态的有：")]),t._v(" "),i("ul",[i("li",[i("p",[t._v("FLAG_ACTIVITY_CLEAR_TOP：当此Activity启动时，在同一个任务栈中所有位于它上面的Activity都要出栈。"),i("code",[t._v("singleTask")]),t._v("启动模式默认就具有这个效果。")])]),t._v(" "),i("li",[i("p",[t._v("FLAG_EXCLUDE_FROM_RECENTS：与"),i("code",[t._v('android:excludeFromRecents="true"')]),t._v("一致。此Activity不会出现在历史Activity的列表中。")])]),t._v(" "),i("li",[i("p",[t._v("FLAG_ACTIVITY_CLEAR_TASK：当此Activity启动时，在同一个任务栈中的其他Activity都要被清除，它会成为该栈的根。这个标志必须与"),i("code",[t._v("FLAG_ACTIVITY_NEW_TASK")]),t._v("一起使用。")])])])])}],!1,null,null,null);v.options.__file="Activity启动模式.md";a.default=v.exports}}]);