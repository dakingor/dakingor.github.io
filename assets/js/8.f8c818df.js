(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{152:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p"),t._m(1),s("p"),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("基于"),s("a",{attrs:{href:"http://androidxref.com/7.0.0_r1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android 7.0.0_r1源码"),s("OutboundLink")],1),t._v("浅析Activity生命周期，下面涉及的代码只列出关键部分。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("综上可得，mAppThread是ApplicationThread类对象，实现了IApplicationThread接口的方法，是一个提供对外服务的Stub对象。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("ActivityManagerNative与上面的ApplicationThread类似，也是一种Binder通信设计。")]),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("综上可得，mgr是ActivityManagerProxy类对象，是IActivityManager的远程服务代理Proxy。这意味着Android程序可通过这个mgr来远程调用系统服务AMS。")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),s("p",[t._v("此方法将ApplicationThread类对象传给远程的ActivityManager，即系统服务AMS就拥有ApplicationThread的本地代理，这意味着系统服务AMS可远程调用这个ApplicationThread代理对象来控制Android程序。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._m(36),t._m(37),s("p",[t._v("一个Android程序启动到首个Activity进入前台的源码浅析过程到此为止。")])])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"activity生命周期的源码分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activity生命周期的源码分析","aria-hidden":"true"}},[this._v("#")]),this._v(" Activity生命周期的源码分析")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#生命周期的源码浅析"}},[t._v("生命周期的源码浅析")])]),s("li",[s("a",{attrs:{href:"#activitythread-main"}},[t._v("ActivityThread#main()")])]),s("li",[s("a",{attrs:{href:"#iapplicationthread"}},[t._v("IApplicationThread")])]),s("li",[s("a",{attrs:{href:"#iactivitymanager"}},[t._v("IActivityManager")])]),s("li",[s("a",{attrs:{href:"#activitymanagerproxy-attachapplication"}},[t._v("ActivityManagerProxy#attachApplication()")])]),s("li",[s("a",{attrs:{href:"#h-launch-activity消息"}},[t._v("H.LAUNCH_ACTIVITY消息")])]),s("li",[s("a",{attrs:{href:"#activitythread-handlelaunchactivity"}},[t._v("ActivityThread#handleLaunchActivity()")])]),s("li",[s("a",{attrs:{href:"#activitythread-performlaunchactivity"}},[t._v("ActivityThread#performLaunchActivity()")])]),s("li",[s("a",{attrs:{href:"#activitythread-handleresumeactivity"}},[t._v("ActivityThread#handleResumeActivity()")])])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"生命周期的源码浅析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期的源码浅析","aria-hidden":"true"}},[this._v("#")]),this._v(" 生命周期的源码浅析")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"activitythread-main"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activitythread-main","aria-hidden":"true"}},[this._v("#")]),this._v(" ActivityThread#main()")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("Java程序有main静态方法作为入口，Android程序也一样。"),a("code",[this._v("android.app.ActivityThread")]),this._v("的main静态方法就是Android程序的入口。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("main")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 忽略无关代码")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 当前线程是主线程，为主线程创建Looper")]),t._v("\n    Looper"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("prepareMainLooper")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    ActivityThread thread "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("ActivityThread")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    thread"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("attach")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sMainThreadHandler "),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sMainThreadHandler "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" thread"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getHandler")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Looper"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("myLooper")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setMessageLogging")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("LogPrinter")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Log"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEBUG"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"ActivityThread"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// End of event ActivityThreadMain.")]),t._v("\n    Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("traceEnd")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRACE_TAG_ACTIVITY_MANAGER"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Looper"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("loop")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("RuntimeException")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Main thread loop unexpectedly exited"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("接着看"),a("code",[this._v("android.app.ActivityThread")]),this._v("的attach方法。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("attach")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" system"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    sCurrentActivityThread "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 忽略无关代码")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// mgr为IActivityManager本地代理Proxy对象，即系统服务AMS的本地代理")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" IActivityManager mgr "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" ActivityManagerNative"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getDefault")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// mAppThread为IApplicationThread对外提供服务的Stub对象")]),t._v("\n        mgr"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("attachApplication")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mAppThread"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token class-name"}},[t._v("RemoteException")]),t._v(" ex"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" ex"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("rethrowFromSystemServer")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 忽略无关代码")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"iapplicationthread"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iapplicationthread","aria-hidden":"true"}},[this._v("#")]),this._v(" IApplicationThread")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("上面"),a("code",[this._v("ActivityThread#attach(boolean)")]),this._v("中的mAppThread是"),a("code",[this._v("android.app.ActivityThread$ApplicationThread")]),this._v("类型的对象。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("ApplicationThread继承了"),a("code",[this._v("android.app.ApplicationThreadNative")]),this._v("抽象类，而ApplicationThreadNative是Binder通信中典型的Stub + Proxy设计。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[s("p",[t._v("ApplicationThreadNative类继承"),s("code",[t._v("android.os.Binder")]),t._v("，并实现"),s("code",[t._v("android.app.IApplicationThread")]),t._v("接口。其实就是提供对外服务的Stub。")])]),t._v(" "),s("li",[s("p",[t._v("ApplicationThreadNative类中定义了一个非公开类ApplicationThreadProxy，它实现"),s("code",[t._v("android.app.IApplicationThread")]),t._v("接口。其实就是远程服务代理Proxy。")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"iactivitymanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iactivitymanager","aria-hidden":"true"}},[this._v("#")]),this._v(" IActivityManager")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("上面"),a("code",[this._v("ActivityThread#attach(boolean)")]),this._v("中的mgr是"),a("code",[this._v("android.app.IActivityManager")]),this._v("接口的实现对象，它是由"),a("code",[this._v("ActivityManagerNative#getDefault()")]),this._v("获得的。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[a("p",[this._v("ActivityManagerNative类是IActivityManager的提供对外服务的Stub。")])]),this._v(" "),a("li",[a("p",[this._v("ActivityManagerNative类中定义了一个非公开类ActivityManagerProxy，它是IActivityManager的远程服务代理Proxy。")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"activitymanagerproxy-attachapplication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activitymanagerproxy-attachapplication","aria-hidden":"true"}},[this._v("#")]),this._v(" ActivityManagerProxy#attachApplication()")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("再回到之前"),a("code",[this._v("ActivityThread#attach(boolean)")]),this._v("中的"),a("code",[this._v("mgr.attachApplication(mAppThread)")]),this._v("，其实它是调用ActivityManagerProxy对象的"),a("code",[this._v("attachApplication(IApplicationThread)")]),this._v("方法。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityManagerNative$ActivityManagerProxy */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("attachApplication")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IApplicationThread app"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Parcel data "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Parcel"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("obtain")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Parcel reply "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Parcel"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("obtain")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("writeInterfaceToken")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IActivityManager"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("descriptor"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("writeStrongBinder")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("asBinder")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    mRemote"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("transact")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ATTACH_APPLICATION_TRANSACTION"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reply"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    reply"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("readException")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    data"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("recycle")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    reply"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("recycle")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("在"),a("code",[this._v("mgr.attachApplication(mAppThread)")]),this._v("执行完后，Android程序与系统服务AMS之间的双向通信就建立完毕。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"h-launch-activity消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#h-launch-activity消息","aria-hidden":"true"}},[this._v("#")]),this._v(" H.LAUNCH_ACTIVITY消息")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("系统服务AMS调用ApplicationThread本地代理对象的"),a("code",[this._v("transact(SCHEDULE_LAUNCH_ACTIVITY_TRANSACTION)")]),this._v("，就会触发对应Android程序的ApplicationThreadNative对象（IApplicationThread的Stub）的scheduleLaunchActivity方法，即"),a("code",[this._v("ActivityThread$ApplicationThread")]),this._v("的scheduleLaunchActivity方法被调用。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread$ApplicationThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("scheduleLaunchActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    ActivityClientRecord r "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("ActivityClientRecord")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("H"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LAUNCH_ACTIVITY"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("上面为scheduleLaunchActivity方法的关键代码，就是把一条携带ActivityClientRecord信息和名为"),a("code",[this._v("H.LAUNCH_ACTIVITY")]),this._v("的消息。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" what"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Object obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("what"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" what"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Object obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg1"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg2"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" async"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DEBUG_MESSAGES"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Slog"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("v")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        TAG"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"SCHEDULE "')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" what "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('" "')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" mH"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("codeToString")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("what"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('": "')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" arg1 "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('" / "')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Message msg "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Message"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("obtain")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("what "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" what"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arg1 "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" arg1"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arg2 "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" arg2"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("async"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("setAsynchronous")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    mH"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("p",[t._v("从上可知，消息最终是通过mH来发送，mH是"),s("code",[t._v("Activity$H")]),t._v("类型的对象。H继承Handler，它是主线程Looper的消息处理器。上面的发送"),s("code",[t._v("H.LAUNCH_ACTIVITY")]),t._v("消息，最后会导致"),s("code",[t._v("Activity$H")]),t._v("的handleMessage方法被调用，由其"),s("code",[t._v("case LAUNCH_ACTIVITY")]),t._v("分支来处理。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread$H */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("handleMessage")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Message msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("what"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" LAUNCH_ACTIVITY"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("traceBegin")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRACE_TAG_ACTIVITY_MANAGER"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"activityStart"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" ActivityClientRecord r "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ActivityClientRecord"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" msg"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("packageInfo "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("getPackageInfoNoCheck")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activityInfo"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("applicationInfo"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compatInfo"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token function"}},[t._v("handleLaunchActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"LAUNCH_ACTIVITY"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("traceEnd")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Trace"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRACE_TAG_ACTIVITY_MANAGER"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),s("span",{attrs:{class:"token keyword"}},[t._v("break")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"activitythread-handlelaunchactivity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activitythread-handlelaunchactivity","aria-hidden":"true"}},[this._v("#")]),this._v(" ActivityThread#handleLaunchActivity()")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("对"),a("code",[this._v("H.LAUNCH_ACTIVITY")]),this._v("消息的处理会调用ActivityThread的handleLaunchActivity方法。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("handleLaunchActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ActivityClientRecord r"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Intent customIntent"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String reason"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取系统服务WindowManager的本地代理")]),t._v("\n    WindowManagerGlobal"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("initialize")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 创建Activity并回调onCreate")]),t._v("\n    Activity a "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("performLaunchActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" customIntent"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("createdConfig "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Configuration")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mConfiguration"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token function"}},[t._v("reportSizeConfigurations")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        Bundle oldState "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// 回调onResume")]),t._v("\n        "),s("span",{attrs:{class:"token function"}},[t._v("handleResumeActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isForward"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mFinished "),s("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startsNotResumed"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastProcessedSeq"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reason"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"activitythread-performlaunchactivity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activitythread-performlaunchactivity","aria-hidden":"true"}},[this._v("#")]),this._v(" ActivityThread#performLaunchActivity()")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[a("code",[this._v("ActivityThread#handleLaunchActivity()")]),this._v("会调用"),a("code",[this._v("ActivityThread#performLaunchActivity()")]),this._v("来创建Activity，并调用其onCreate、onStart和onRestoreInstanceState等生命周期方法。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" Activity "),s("span",{attrs:{class:"token function"}},[t._v("performLaunchActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ActivityClientRecord r"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Intent customIntent"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    Activity activity "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        java"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClassLoader cl "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("packageInfo"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getClassLoader")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// 创建Activity")]),t._v("\n        activity "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("newActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            cl"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getClassName")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("intent"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Application app "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("packageInfo"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("makeApplication")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// 调用Activity的onCreate方法")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("isPersistable")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callActivityOnCreate")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistentState"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callActivityOnCreate")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// 调用Activity的onStart方法")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mFinished"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("performStart")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stopped "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// 调用Activity的onRestoreInstanceState方法")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mFinished"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("isPersistable")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null "),s("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistentState "),s("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callActivityOnRestoreInstanceState")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistentState"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callActivityOnRestoreInstanceState")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"activitythread-handleresumeactivity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activitythread-handleresumeactivity","aria-hidden":"true"}},[this._v("#")]),this._v(" ActivityThread#handleResumeActivity()")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[a("code",[this._v("ActivityThread#handleLaunchActivity()")]),this._v("在处理完Activity的创建和onCreate、onStart等生命周期回调后，会调用"),a("code",[this._v("ActivityThread#handleResumeActivity()")]),this._v("来进入onResume生命周期的回调过程。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("handleResumeActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IBinder token"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" clearHide"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    "),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" isForward"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" reallyResume"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" seq"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String reason"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ActivityClientRecord r "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mActivities"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    r "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("performResumeActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" clearHide"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reason"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.ActivityThread */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" ActivityClientRecord "),s("span",{attrs:{class:"token function"}},[t._v("performResumeActivity")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    IBinder token"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" clearHide"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String reason"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ActivityClientRecord r "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mActivities"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    r"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("performResume")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("/* android.app.Activity */")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("performResume")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// 调用Activity的onResume方法")]),t._v("\n    mInstrumentation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callActivityOnResume")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])}],!1,null,null,null);e.options.__file="Activity生命周期的源码分析.md";a.default=e.exports}}]);