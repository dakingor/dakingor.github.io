(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{157:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p"),t._m(1),n("p"),t._v(" "),t._m(2),t._v(" "),n("p",[t._v("Binder是Android系统中基于开源OpenBinder实现的一种进程间通信（IPC）的机制。")]),t._v(" "),n("p",[t._v("Android应用程序是由Activity，Service、BroadcastReceiver和Content Provider这四大组件组成，有时这些组件运行在不同的应用或进程中，需要使用Binder机制来进行通信。")]),t._v(" "),n("p",[t._v("Android系统对应用层提供的各种服务，如ActivityManagerService、PackageManagerService等都是基于Binder机制来实现的。")]),t._v(" "),t._m(3),t._v(" "),n("p",[t._v("Android系统是基于Linux内核的，虽然Linux已经提供了管道、消息队列、共享内存和Socket等IPC机制，但基于性能、稳定性和安全性等因素，Android系统还是设计了自己特有的Binder IPC机制。")]),t._v(" "),t._m(4),t._v(" "),n("p",[t._v("Socket作为一款通用接口，其传输效率低、开销大，主要用在跨网络进程间通信和本机上进程间的低速通信。")]),t._v(" "),n("p",[t._v("管道和消息队列采用存储-转发方式，即数据从发送方缓存区拷贝到内核开辟的缓存区中，然后再从内核缓存区拷贝到接收方缓存区，至少经历两次拷贝。")]),t._v(" "),n("p",[t._v("共享内存虽然无需进行内存拷贝，但控制复杂、难以使用。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),n("p",[t._v("传统的IPC机制没有任何安全措施，完全依赖上层协议来确保。")]),t._v(" "),n("p",[t._v("Android系统为每个安装好的App分配了UID，因此进程的UID是鉴别身份的重要标志。而传统IPC的接收方无法获得对方可靠的进程ID/用户ID（PID/UID），从而无法鉴别对方身份。")]),t._v(" "),n("p",[t._v("传统IPC可以由用户在数据包中填入UID/PID，但这样不可靠，可靠的身份标识只能由IPC机制在内核中添加。")]),t._v(" "),n("p",[t._v("传统IPC的访问接入点是开放的，只要知道这些接入点的程序都可以建立连接，无法阻止恶意程序通过猜测接入点来获得连接。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),n("p",[t._v("上图展示了Linux跨进程通信涉及到的一些基本概念：")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),n("p",[t._v("在操作系统中，进程之间的内存是不共享的。进程之间要进行数据交互需要采用特殊的通信机制，称为进程间通信（Inter Process Communication, IPC）。")]),t._v(" "),t._m(15),t._v(" "),n("p",[t._v("现代操作系统都采用虚拟存储器，对于32位系统而言，它的寻址空间为2的32次方，即4GB。")]),t._v(" "),n("p",[t._v("操作系统的核心是内核，它独立于普通的应用程序，可以访问受保护的内存空间，也可以访问底层硬件设备。")]),t._v(" "),n("p",[t._v("为了使用户进程不能直接操作内核，保证内核的安全，操作系统从逻辑上将虚拟空间划分为用户空间和内核空间。")]),t._v(" "),n("p",[t._v("对于32位的Linux系统而言，将最高的1GB给内核使用，即内核空间；而较低的3GB供给各进程使用，即用户空间。")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),n("p",[t._v("系统调用是用户空间访问内核的唯一方式，这保证了所有的资源访问都是在内核的控制下进行的，避免了用户程序对系统资源的越权访问，提升了系统安全性和稳定性。")]),t._v(" "),n("p",[t._v("Linux使用两级保护机制：0级供系统内核使用，3级供用户程序使用。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),n("p",[t._v("系统调用主要是通过如下两个函数来实现：")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),n("p",[t._v("在传统IPC中，进程之间的通信是：")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),n("p",[t._v("这种传统的IPC通信方式主要有两个问题：")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),n("p",[t._v("模块是具有独立功能的程序，它可以被单独编译，但不能独立运行。它在运行时被链接到内核，作为内核的一部分来运行。")]),t._v(" "),n("p",[t._v("Android系统是基于Linux内核的，而得益于Linux的动态内核可加载模块（Loadable Kernel Module, LKM）的机制，Android系统可以通过动态添加一个内核模块运行在内核空间，用户进程之间通过此内核模块作为桥梁来实现通信。")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),n("p",[t._v("内存映射就是将用户空间的一块内存区域映射到内核空间。")]),t._v(" "),n("p",[t._v("映射关系建立后，用户对这块内存区域的修改可以直接反应到内核空间；反之，内核空间对这个区域的修改也能直接反应到用户空间。")]),t._v(" "),n("p",[t._v("内存映射能够减少数据拷贝次数，实现用户空间和内核空间的高效互动。两个空间各自的修改能直接反应到映射的内存区域，从而被对方及时感知。")]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),n("p",[t._v("一次完整的Binder IPC通信过程如下：")]),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),n("p",[t._v("一次完整的进程之间的通信必然至少包含两个进程，即客户端进程（Client）和服务端进程（Server）。")]),t._v(" "),n("p",[t._v("由于进程隔离机制的存在，通信双方需要借助Binder来实现。")]),t._v(" "),t._m(36),t._v(" "),n("p",[t._v("Binder是基于C/S架构的，由一系列组件组成，包括Client、Server、ServiceManager、Binder Driver。")]),t._v(" "),n("p",[t._v("Client、Server、ServiceManager运行在用户空间，而Binder Driver运行在内核空间。")]),t._v(" "),n("p",[t._v("ServiceManager和Binder Driver由Android系统提供，而Client和Server由应用程序实现。")]),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),n("p",[t._v("Server、Client、ServiceManager和Binder Driver等Binder通信组件在通信过程中扮演的角色可以依次类比成互联网中的服务器、客户端、DNS服务器以及路由器之间的关系。")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),n("p",[t._v("Client进程无法直接使用Server进程中的某个对象（Object）。")]),t._v(" "),n("p",[t._v("当Client进程请求使用Server进程的Object时，Binder Driver会将Server的Object转换成一个代理对象ProxyObject，然后返回给Client。")]),t._v(" "),t._m(44),t._v(" "),n("p",[t._v("这个ProxyObject具有和Server Object一样的方法，但却没有Server Object真正的能力。因此，Client调用请求是由Binder Driver转交给Server来完成：")]),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),n("p",[t._v("在Android应用开发中，实现进程间通信用的最多的是AIDL。")]),t._v(" "),t._m(50),t._v(" "),t._m(51),t._m(52),t._v(" "),n("p",[t._v("Android对AIDL自动生成的代码文件使用这种多层嵌套的设计的原因是，当有多个AIDL文件时，将IRemoteService、Stub和Proxy放在同一个文件中能有效避免Stub和Proxy重名的问题。")]),t._v(" "),t._m(53),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),n("p",[t._v("这个IRemoteService对象是Stub对象或Proxy对象，这取决于Client和Server是否在同一个进程中。使用该对象可调用Server提供的功能。")]),t._v(" "),t._m(58),t._v(" "),n("p",[t._v("根据AIDL自动编码实现的Binder通信来理解原理，从而使用手动编码实现高可读性、结构更清晰的Binder通信。")]),t._v(" "),n("p",[t._v("首先，定义一个IRemoteService接口，继承IInterface，表明Server端具备怎样的能力。另外，也可以定义一些通用常量。")]),t._v(" "),t._m(59),n("p",[t._v("接着，实现一个对外提供服务的跨进程调用对象Stub。")]),t._v(" "),t._m(60),n("p",[t._v("然后，创建远程服务的代理对象Proxy。")]),t._v(" "),t._m(61),t._m(62),t._v(" "),t._m(63),t._m(64),t._v(" "),t._m(65),n("p",[t._v("通过这个IRemoteService对象可调用Server的功能。")]),t._v(" "),t._m(66),t._v(" "),n("p",[t._v("Proxy远程调用的过程如下：")]),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5acccf845188255c3201100f",target:"_blank",rel:"noopener noreferrer"}},[t._v("写给Android应用工程师的Binder原理剖析"),n("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"binder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#binder的定义"}},[t._v("Binder的定义")])]),n("li",[n("a",{attrs:{href:"#binder的优势"}},[t._v("Binder的优势")]),n("ul",[n("li",[n("a",{attrs:{href:"#性能"}},[t._v("性能")])]),n("li",[n("a",{attrs:{href:"#稳定性"}},[t._v("稳定性")])]),n("li",[n("a",{attrs:{href:"#安全性"}},[t._v("安全性")])])])]),n("li",[n("a",{attrs:{href:"#linux下传统的进程间通信原理"}},[t._v("Linux下传统的进程间通信原理")]),n("ul",[n("li",[n("a",{attrs:{href:"#基本概念"}},[t._v("基本概念")])]),n("li",[n("a",{attrs:{href:"#传统ipc通信原理"}},[t._v("传统IPC通信原理")])])])]),n("li",[n("a",{attrs:{href:"#binder跨进程通信原理"}},[t._v("Binder跨进程通信原理")]),n("ul",[n("li",[n("a",{attrs:{href:"#动态内核可加载模块"}},[t._v("动态内核可加载模块")])]),n("li",[n("a",{attrs:{href:"#内存映射"}},[t._v("内存映射")])]),n("li",[n("a",{attrs:{href:"#binder-ipc实现原理"}},[t._v("Binder IPC实现原理")])])])]),n("li",[n("a",{attrs:{href:"#binder通信模型"}},[t._v("Binder通信模型")]),n("ul",[n("li",[n("a",{attrs:{href:"#binder通信组件"}},[t._v("Binder通信组件")])]),n("li",[n("a",{attrs:{href:"#binder通信过程"}},[t._v("Binder通信过程")])]),n("li",[n("a",{attrs:{href:"#binder通信中的代理模式"}},[t._v("Binder通信中的代理模式")])])])]),n("li",[n("a",{attrs:{href:"#binder跨进程通信的编码实现"}},[t._v("Binder跨进程通信的编码实现")]),n("ul",[n("li",[n("a",{attrs:{href:"#各java类职责"}},[t._v("各Java类职责")])]),n("li",[n("a",{attrs:{href:"#binder通信的自动编码实现（aidl）"}},[t._v("Binder通信的自动编码实现（AIDL）")])]),n("li",[n("a",{attrs:{href:"#binder通信的手动编码实现"}},[t._v("Binder通信的手动编码实现")])])])]),n("li",[n("a",{attrs:{href:"#参考资料"}},[t._v("参考资料")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binder的定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder的定义","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder的定义")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binder的优势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder的优势","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder的优势")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"性能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能","aria-hidden":"true"}},[this._v("#")]),this._v(" 性能")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Binder"),s("strong",[this._v("只需要一次内存拷贝")]),this._v("，性能上仅次于共享内存。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"稳定性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#稳定性","aria-hidden":"true"}},[this._v("#")]),this._v(" 稳定性")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Binder"),s("strong",[this._v("基于C/S架构")]),this._v("，架构清晰、职责明确且相互独立，所以稳定性更好。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安全性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全性","aria-hidden":"true"}},[this._v("#")]),this._v(" 安全性")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Binder IPC机制"),s("strong",[this._v("可以解决身份鉴别、访问接入控制")]),this._v("等问题。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"linux下传统的进程间通信原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux下传统的进程间通信原理","aria-hidden":"true"}},[this._v("#")]),this._v(" Linux下传统的进程间通信原理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本概念","aria-hidden":"true"}},[this._v("#")]),this._v(" 基本概念")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315459186625.jpg",alt:"Linux跨进程通信"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("进程隔离")])]),this._v(" "),s("li",[s("p",[this._v("进程空间划分：用户空间（User space）/内核空间（Kernel space）")])]),this._v(" "),s("li",[s("p",[this._v("系统调用：用户态/内核态")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"进程隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进程隔离","aria-hidden":"true"}},[this._v("#")]),this._v(" 进程隔离")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"进程空间划分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进程空间划分","aria-hidden":"true"}},[this._v("#")]),this._v(" 进程空间划分")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"系统调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统调用","aria-hidden":"true"}},[this._v("#")]),this._v(" 系统调用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("内核空间能直接访问内核资源，如文件操作、访问网络等，而用户需要借助"),s("strong",[this._v("系统调用")]),this._v("来实现。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当进程使用系统调用而陷入内核代码中时，其处于内核运行态（"),s("strong",[this._v("内核态")]),this._v("）。此时，处理器在特权级最高（0级）的内核代码中执行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("每个进程都有自己的"),s("strong",[this._v("内核栈")]),this._v("，当进程处于内核态时，执行的内核代码会使用当前进程的内核栈。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当进程执行用户自己的代码时，其处于用户运行态（"),s("strong",[this._v("用户态")]),this._v("）。此时，处理器在特权级最低（3级）的用户代码中执行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[s("code",[this._v("copy_from_user()")]),this._v("，将数据从用户空间拷贝到内核空间。")])]),this._v(" "),s("li",[s("p",[s("code",[this._v("copy_to_user()")]),this._v("，将数据从内核空间拷贝到用户空间。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"传统ipc通信原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传统ipc通信原理","aria-hidden":"true"}},[this._v("#")]),this._v(" 传统IPC通信原理")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("p",[t._v("发送进程将要发送的数据放在自己的用户空间开辟出的**内存缓存区（发送进程）**中，通过系统调用进入内核态。")])]),t._v(" "),n("li",[n("p",[t._v("内核程序在内核空间中开辟出一块"),n("strong",[t._v("内核缓存区")]),t._v("，再调用"),n("code",[t._v("copy_from_user()")]),t._v("将数据从发送进程的内存缓存区拷贝到内核缓存区中。")])]),t._v(" "),n("li",[n("p",[t._v("接收进程在接收数据时，在自己的用户空间中开辟出一块"),n("strong",[t._v("内存缓存区（接收进程")]),t._v("）。")])]),t._v(" "),n("li",[n("p",[t._v("内核程序调用"),n("code",[t._v("copy_to_user()")]),t._v("将数据从内核缓存区拷贝到接收进程的内存缓存区。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315465819335.jpg",alt:"传统IPC通信原理"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("性能低下，一次数据传递需要经历两次拷贝：发送进程的内存缓存区 -> 内核缓存区 -> 接收进程的内存缓存区。")])]),this._v(" "),s("li",[s("p",[this._v("接收数据的内存缓存区由接收进程提供，但接收进程事先并不知道需要多大的空间来存放数据，所以只能开辟尽可能大的内存空间（浪费空间）或者先调用API查询消息大小（耗时）。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binder跨进程通信原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder跨进程通信原理","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder跨进程通信原理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"动态内核可加载模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态内核可加载模块","aria-hidden":"true"}},[this._v("#")]),this._v(" 动态内核可加载模块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在Android系统中，这个运行在内核空间，负责各个用户进程通过Binder实现通信的内核模块叫做"),s("strong",[this._v("Binder驱动")]),this._v("（Binder Driver）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"内存映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存映射","aria-hidden":"true"}},[this._v("#")]),this._v(" 内存映射")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("mmap()")]),this._v("是操作系统中一种内存映射的方法，而Binder IPC机制中涉及到的内存映射是通过"),s("code",[this._v("mmap()")]),this._v("来实现的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder-ipc实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder-ipc实现原理","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder IPC实现原理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Binder IPC使用"),s("code",[this._v("mmap()")]),this._v("在内核空间创建数据接收的缓存空间。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ol",[n("li",[n("p",[t._v("Binder驱动在内核空间创建一个数据接收缓存区。")])]),t._v(" "),n("li",[n("p",[t._v("在内核空间开辟一块内核缓存区，并建立"),n("em",[t._v("内核缓存区")]),t._v("和"),n("em",[t._v("数据接收缓存区")]),t._v("之间的映射关系，以及"),n("em",[t._v("数据接收缓存区")]),t._v("和"),n("em",[t._v("接收进程用户空间地址")]),t._v("的映射关系。")])]),t._v(" "),n("li",[n("p",[t._v("发送进程利用系统调用"),n("code",[t._v("copy_from_user()")]),t._v("函数将数据拷贝到内核缓存区，由于内核缓存区、数据接收缓存区和接收进程的用户空间地址三者之间存在内存映射，所以此操作相当于把数据发送到了接收进程的用户空间。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315510041844.jpg",alt:"Binder IPC实现原理"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binder通信模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信模型","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信模型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder通信组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信组件","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信组件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Client、Server和ServiceManager都是通过系统调用open、mmap和ioctl来访问设备文件"),s("code",[this._v("/dev/binder")]),this._v("，从而与Binder Driver交互来间接实现跨进程通信。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315554986113.jpg",alt:"Binder通信组件"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315555192040.jpg",alt:"类比成网页访问"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder通信过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信过程","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信过程")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ol",[n("li",[n("p",[t._v("一个进程使用"),n("code",[t._v("BINDER_SET_CONTEXT_MGR")]),t._v("命令通过Binder Driver将自己注册成为ServiceManager。")])]),t._v(" "),n("li",[n("p",[t._v("Server进程通过Binder Driver向ServiceManager中注册Server Binder实体，表明可以对外提供服务。")])]),t._v(" "),n("li",[n("p",[t._v("Binder Driver为这个Server Binder创建位于内核中的实体节点以及ServiceManager对此实体的引用。ServiceManager将Server名称和刚新建的实体引用填入查找表中。")])]),t._v(" "),n("li",[n("p",[t._v("Client进程在Binder Driver的帮助下，通过服务名从ServiceManager中获取到对Server Binder实体的引用，通过这个引用就能实现和Server进程的通信。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315557943326.jpg",alt:"Binder通信过程"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder通信中的代理模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信中的代理模式","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信中的代理模式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/15234960313166/15315558195622.jpg",alt:"Binder通信中的代理模式"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("当Client调用ProxyObject的方法时，Binder Driver会通知Server进程，进而调用对应的Server Object的指定方法来处理请求。")])]),this._v(" "),s("li",[s("p",[this._v("Binder Driver拿到Server的返回结果后转发给Client，通信完成。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binder跨进程通信的编码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder跨进程通信的编码实现","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder跨进程通信的编码实现")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"各java类职责"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#各java类职责","aria-hidden":"true"}},[this._v("#")]),this._v(" 各Java类职责")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("p",[t._v("IBinder：IBinder是一个接口，代表了一种跨进程通信的能力。只要实现了这个接口，这个对象就能跨进程传输。")])]),t._v(" "),n("li",[n("p",[t._v("IInterface：IInterface代表的是Server进程对象具备怎样的能力，比如提供哪些方法。其实IInterface对应的就是AIDL文件中定义的接口。")])]),t._v(" "),n("li",[n("p",[t._v("Binder："),n("code",[t._v("android.os.Binder")]),t._v("类，表示Binder本地对象。")])]),t._v(" "),n("li",[n("p",[t._v("Stub：编译工具根据AIDL文件生成的类。这个类继承Binder，表明它是一个Binder本地对象；它实现了IInterface接口，表明它具有Server承诺给Client的能力。Stub是一个抽象类，具体的IInterface接口实现需要由开发者实现。")])]),t._v(" "),n("li",[n("p",[t._v("Proxy：编译工具根据AIDL文件生成的Stub类中的内部类。它实现IInterface接口，表明它具有Server承诺给Client的能力。它是一个Server进程的Binder对象的本地代理。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder通信的自动编码实现（aidl）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信的自动编码实现（aidl）","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信的自动编码实现（AIDL）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先，定义AIDL文件，表明Server具备怎样的能力。如"),s("code",[this._v("IRemoteService.aidl")]),this._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("/* IRemoteService.aidl */\npackage com.daking.aidl;\n\ninterface IRemoteService {\n    String getName();\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("接着，编译后会自动生成对应的java文件。比如，编译器根据"),s("code",[this._v("IRemoteService.aidl")]),this._v("生成"),s("code",[this._v("IRemoteService.java")]),this._v("，这个java文件包含一个IRemoteService接口、一个Stub静态抽象类和一个Proxy静态类。而Proxy是Stub的静态内部类，而Stub又是IRemoteService的静态内部类。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* IRemoteService.java */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IInterface")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Stub")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Binder")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String DESCRIPTOR "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"com.daking.aidl.IRemoteService"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Stub")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("attachInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService "),n("span",{attrs:{class:"token function"}},[t._v("asInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IInterface iin "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("queryLocalInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iin "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iin "),n("span",{attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 若Client和Server位于同一进程，直接返回Stub对象")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" iin"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 若Client和Server在不同进程，返回Stub.Proxy对象")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Stub"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Proxy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder "),n("span",{attrs:{class:"token function"}},[t._v("asBinder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 处理由Binder Driver转发的Client请求")]),t._v("\n        "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("onTransact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" INTERFACE_TRANSACTION"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" TRANSACTION_getName"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("enforceInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String _result "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeNoException")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_result"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("super")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("onTransact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Proxy")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("com"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("daking"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aidl"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),n("span",{attrs:{class:"token function"}},[t._v("Proxy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder remote"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                mRemote "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" remote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder "),n("span",{attrs:{class:"token function"}},[t._v("asBinder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String "),n("span",{attrs:{class:"token function"}},[t._v("getInterfaceDescriptor")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 将Client的调用请求转发给Binder Driver，进而调用Server。")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 接收Binder Driver返回的Server处理结果。")]),t._v("\n                android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel _data "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("obtain")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel _reply "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parcel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("obtain")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String _result"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeInterfaceToken")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("transact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Stub"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRANSACTION_getName"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("readException")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    _result "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("readString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("recycle")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("recycle")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _result"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 对外提供的各方法ID")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" TRANSACTION_getName "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IBinder"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FIRST_CALL_TRANSACTION "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" android"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("os"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteException"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br"),n("span",{staticClass:"line-number"},[t._v("66")]),n("br"),n("span",{staticClass:"line-number"},[t._v("67")]),n("br"),n("span",{staticClass:"line-number"},[t._v("68")]),n("br"),n("span",{staticClass:"line-number"},[t._v("69")]),n("br"),n("span",{staticClass:"line-number"},[t._v("70")]),n("br"),n("span",{staticClass:"line-number"},[t._v("71")]),n("br"),n("span",{staticClass:"line-number"},[t._v("72")]),n("br"),n("span",{staticClass:"line-number"},[t._v("73")]),n("br"),n("span",{staticClass:"line-number"},[t._v("74")]),n("br"),n("span",{staticClass:"line-number"},[t._v("75")]),n("br"),n("span",{staticClass:"line-number"},[t._v("76")]),n("br"),n("span",{staticClass:"line-number"},[t._v("77")]),n("br"),n("span",{staticClass:"line-number"},[t._v("78")]),n("br"),n("span",{staticClass:"line-number"},[t._v("79")]),n("br"),n("span",{staticClass:"line-number"},[t._v("80")]),n("br"),n("span",{staticClass:"line-number"},[t._v("81")]),n("br"),n("span",{staticClass:"line-number"},[t._v("82")]),n("br"),n("span",{staticClass:"line-number"},[t._v("83")]),n("br"),n("span",{staticClass:"line-number"},[t._v("84")]),n("br"),n("span",{staticClass:"line-number"},[t._v("85")]),n("br"),n("span",{staticClass:"line-number"},[t._v("86")]),n("br"),n("span",{staticClass:"line-number"},[t._v("87")]),n("br"),n("span",{staticClass:"line-number"},[t._v("88")]),n("br"),n("span",{staticClass:"line-number"},[t._v("89")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Server进程需要构建一个"),s("code",[this._v("android.app.Service")]),this._v("子类，为Client进程提供服务，并在这个Service子类中实现"),s("code",[this._v("IRemoteService.Stub")]),this._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* RemoteService */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("RemoteService")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Service")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("RemoteService")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" IBinder "),n("span",{attrs:{class:"token function"}},[t._v("onBind")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Intent intent"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mBinder"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Stub mBinder "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Stub")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"RemoteService from server process"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Client进程绑定RemoteService服务，随后通过"),s("code",[this._v("IRemoteService.Stub.asInterface()")]),this._v("将服务绑定成功回调的IBinder对象转换成IRemoteService对象。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* Client */")]),t._v("\nIRemoteService mService"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("onServiceConnected")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ComponentName name"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IBinder service"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mService "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Stub"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("asInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("service"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"binder通信的手动编码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binder通信的手动编码实现","aria-hidden":"true"}},[this._v("#")]),this._v(" Binder通信的手动编码实现")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IInterface")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    String DESCRIPTOR "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"com.daking.aidl.IRemoteService"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" TRANSACTION_getName "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IBinder"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FIRST_CALL_TRANSACTION "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Stub")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Binder")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Stub")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("attachInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" IRemoteService "),n("span",{attrs:{class:"token function"}},[t._v("asInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IBinder obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        IInterface iin "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("queryLocalInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iin "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" null"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iin "),n("span",{attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" iin"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Proxy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" IBinder "),n("span",{attrs:{class:"token function"}},[t._v("asBinder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    \n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("onTransact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Parcel data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Parcel reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" INTERFACE_TRANSACTION"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRANSACTION_getName"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("enforceInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                java"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String _result "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeNoException")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_result"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("super")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("onTransact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flags"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Proxy")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("IRemoteService")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" IBinder mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("Proxy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IBinder remote"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mRemote "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" remote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" IBinder "),n("span",{attrs:{class:"token function"}},[t._v("asBinder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),n("span",{attrs:{class:"token function"}},[t._v("getInterfaceDescriptor")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Parcel _data "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Parcel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("obtain")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        Parcel _reply "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Parcel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("obtain")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        String _result"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("writeInterfaceToken")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DESCRIPTOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            mRemote"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("transact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IRemoteService"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRANSACTION_getName"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("readException")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            _result "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("readString")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            _reply"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("recycle")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            _data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("recycle")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _result"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("之后，Server进程构建一个"),s("code",[this._v("android.app.Service")]),this._v("子类，为Client进程提供服务，并在这个Service子类中实现"),s("code",[this._v("Stub")]),this._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* RemoteService */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("RemoteService")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Service")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("RemoteService")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" IBinder "),n("span",{attrs:{class:"token function"}},[t._v("onBind")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Intent intent"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" mBinder"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" Stub mBinder "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Stub")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" RemoteException "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"RemoteService from server process"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最后，Client进程绑定RemoteService服务，随后通过"),s("code",[this._v("Stub.asInterface()")]),this._v("将服务绑定成功回调的IBinder对象转换成IRemoteService对象。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* Client */")]),t._v("\nIRemoteService mService"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("onServiceConnected")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ComponentName name"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IBinder service"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mService "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Stub"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("asInterface")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("service"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("如果Client和Server在同一个进程，直接调用"),s("strong",[this._v("本地的Stub")]),this._v("实现类对象的方法。")])]),this._v(" "),s("li",[s("p",[this._v("如果Client和Server在不同的进程，通过"),s("strong",[this._v("Proxy代理对象")]),this._v("来完成远程的调用。")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ol",[n("li",[n("p",[t._v("Client调用Proxy对象的某个方法。")])]),t._v(" "),n("li",[n("p",[t._v("Proxy对象的方法内部将要访问的Server名称、要调用的方法ID和传参等信息通过"),n("code",[t._v("transact()")]),t._v("传递给Binder Driver。")])]),t._v(" "),n("li",[n("p",[t._v("Binder Driver找到对应的Server，并将Client的信息传输给它。")])]),t._v(" "),n("li",[n("p",[t._v("Server的Stub实现对象的"),n("code",[t._v("onTransact()")]),t._v("处理请求，并将结果返回给Binder Driver。")])]),t._v(" "),n("li",[n("p",[t._v("Binder Driver将Server的处理结果返回给Client。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资料")])}],!1,null,null,null);e.options.__file="Binder.md";s.default=e.exports}}]);